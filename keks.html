<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OnlyKeks ‚Äì Dein Keks</title>
  <meta name="description" content="Ein Keks mit Message. QR gescannt? Antworte ‚Äì oder schick deinen eigenen Keks." />
  <meta name="theme-color" content="#0E0E11" />
  <style>
    :root{
      --bg:#0E0E11; --text:#F2F2F4; --muted:#B9BBC6;
      --stroke:rgba(255,255,255,.10);
      --panel: rgba(21,21,28,.72);
      --shadow: 0 24px 60px rgba(0,0,0,.55);
      --r:18px;
      --gold:#E6C27A;
      --common:#b9b9b9; --uncommon:#2ecc71; --rare:#4aa3ff; --epic:#b56bff; --legendary:#f6d26a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background: radial-gradient(1200px 700px at 50% 20%, #1a1a24 0%, var(--bg) 55%, #09090c 100%);
    }
    .wrap{max-width:920px;margin:0 auto;padding:18px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:950}
    .logo{width:34px;height:34px;border-radius:12px;display:grid;place-items:center;border:1px solid var(--stroke);background:rgba(255,255,255,.06)}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;border:1px solid var(--stroke);background:rgba(0,0,0,.22);color:var(--muted);font-weight:900;font-size:12px}
    .dot{width:10px;height:10px;border-radius:99px;background:var(--common)}
    .card{
      border:1px solid var(--stroke);
      background: var(--panel);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:16px;
      backdrop-filter: blur(14px);
    }
    .h{margin:0 0 6px;font-size:22px;font-weight:980}
    .sub{margin:0 0 12px;color:var(--muted);line-height:1.45}
    .cookieBox{
      border:1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      background: rgba(0,0,0,.20);
      padding:14px;
      display:grid; gap:12px;
    }
    .cookie{
      width:min(320px, 82vw);
      aspect-ratio:1/1;
      margin:0 auto;
      border-radius:50%;
      background: radial-gradient(circle at 30% 25%, #fff7df 0 22%, #f8d9a4 23% 55%, #e7b46b 56% 100%);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 22px 60px rgba(0,0,0,.35);
      display:grid; place-items:center;
      position:relative;
      overflow:hidden;
    }
    .cookie.heart{border-radius: 18% 18% 35% 35%/18% 18% 45% 45%; transform: rotate(45deg);}
    .cookie.heart .msg{transform: rotate(-45deg);}
    .cookie.star{clip-path: polygon(50% 2%, 61% 35%, 98% 35%, 68% 56%, 79% 92%, 50% 72%, 21% 92%, 32% 56%, 2% 35%, 39% 35%); border-radius:0}
    .glow{position:absolute;inset:-16%;border-radius:50%;filter:blur(18px);opacity:.9;pointer-events:none}
    .msg{
      font-weight:980;
      font-size: clamp(18px, 4.7vw, 30px);
      line-height:1.05;
      color: rgba(15,15,20,.90);
      background: rgba(255,255,255,.40);
      padding: 10px 12px;
      border-radius:16px;
      max-width:92%;
      text-align:center;
      text-shadow: 0 2px 0 rgba(255,255,255,.45);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      height:44px;
      padding:0 14px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
    }
    .btnPrimary{background: linear-gradient(180deg, rgba(230,194,122,.98), rgba(184,137,91,.98)); border-color: rgba(230,194,122,.45); color:#14141A}
    .btnGhost{background: rgba(0,0,0,.22)}
    .input{
      width:100%;
      height:46px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      padding:0 14px;
      font-size:16px;
      font-weight:850;
      outline:none;
    }
    .hint{margin:0;color:rgba(185,187,198,.90);font-size:12.5px;line-height:1.45}
    .vip{border-color: rgba(230,194,122,.22)}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="brand"><div class="logo">üç™</div>OnlyKeks</div>
    <div class="badge"><span class="dot" id="dot"></span><span id="rarity">COMMON</span></div>
  </div>

  <div class="card" id="mainCard">
    <div class="h" id="title">Dein Keks ist da.</div>
    <p class="sub" id="subtitle">Wenn du willst: antworte kurz ‚Äì oder schick selbst einen.</p>

    <div class="cookieBox">
      <div class="cookie" id="cookie">
        <div class="glow" id="glow"></div>
        <div class="msg" id="msg">Ich denk an dich.</div>
      </div>

      <div id="replyBlock" style="display:none">
        <div class="row">
          <input class="input" id="replyInput" maxlength="64" placeholder="Deine Antwort‚Ä¶" />
          <button class="btn btnGhost" id="sendReply" type="button">Antwort senden</button>
        </div>
        <p class="hint">Demo: Antwort wird lokal gespeichert. Sp√§ter: echtes Reply-System.</p>
      </div>

      <div class="row">
        <button class="btn btnPrimary" id="cta" type="button" style="flex:1">So einen auch verschicken</button>
        <button class="btn btnGhost" id="share" type="button" style="flex:1">Link kopieren</button>
      </div>

      <p class="hint" id="foot">QR gescannt? Dann bist du genau richtig.</p>
    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = "ok_draft_v3";
  const RARITY = {
    common:{label:"COMMON", colorVar:"--common", glow:"rgba(185,185,185,.55)", vip:false},
    uncommon:{label:"UNCOMMON", colorVar:"--uncommon", glow:"rgba(46,204,113,.50)", vip:false},
    rare:{label:"RARE", colorVar:"--rare", glow:"rgba(74,163,255,.55)", vip:false},
    epic:{label:"EPIC", colorVar:"--epic", glow:"rgba(181,107,255,.60)", vip:true},
    legendary:{label:"LEGENDARY", colorVar:"--legendary", glow:"rgba(246,210,106,.65)", vip:true},
  };
  function cssVar(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim(); }
  function qs(name){ return new URL(location.href).searchParams.get(name); }

  function loadFromStorage(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return null;
      return JSON.parse(raw);
    }catch(e){ return null; }
  }

  function fallbackFromShare(shareCode){
    const presets = [
      {rarity:"common",shape:"circle",message:"Ich denk an dich."},
      {rarity:"uncommon",shape:"star",message:"Du packst das."},
      {rarity:"rare",shape:"circle",message:"Beweg dein Arsch."},
      {rarity:"epic",shape:"heart",message:"Sorry."},
      {rarity:"legendary",shape:"heart",message:"Komm. Jetzt."}
    ];
    const idx = (parseInt((shareCode||"0").slice(-1),36) || 0) % presets.length;
    return presets[idx];
  }

  function apply(d){
    const rarity = (d.rarity||"common").toLowerCase();
    const cfg = RARITY[rarity] || RARITY.common;

    document.getElementById("rarity").textContent = cfg.label;
    document.getElementById("dot").style.background = cssVar(cfg.colorVar) || "#bbb";
    document.getElementById("msg").textContent = d.message || "‚Ä¶";

    const cookie = document.getElementById("cookie");
    cookie.classList.remove("heart","star");
    if(d.shape==="heart") cookie.classList.add("heart");
    if(d.shape==="star") cookie.classList.add("star");

    document.getElementById("glow").style.background =
      `radial-gradient(circle at 50% 50%, ${cfg.glow} 0%, rgba(0,0,0,0) 60%)`;

    document.getElementById("mainCard").classList.toggle("vip", !!cfg.vip);
    document.getElementById("subtitle").textContent = cfg.vip
      ? "Selten. Besonders. Wenn du willst: antworte ‚Äì oder schick selbst einen."
      : "Wenn du willst: antworte kurz ‚Äì oder schick selbst einen.";
  }

  (function init(){
    const share = qs("share");
    const reply = qs("reply");

    let design = loadFromStorage();

    if(reply){
      document.getElementById("title").textContent = "QR gescannt. Antwort gef√§llig?";
      document.getElementById("subtitle").textContent = "Schreib kurz zur√ºck ‚Äì der Loop lebt.";
      document.getElementById("replyBlock").style.display = "block";
      if(!design || design.orderId !== reply){
        design = fallbackFromShare("0");
      }
    } else if(share){
      document.getElementById("title").textContent = "Keks-Design geladen.";
      document.getElementById("subtitle").textContent = "Gef√§llt dir? Dann schick deinen eigenen.";
      if(!design || design.shareCode !== share){
        design = fallbackFromShare(share);
      }
    } else {
      design = design || fallbackFromShare("0");
    }

    apply(design);

    document.getElementById("cta").onclick = ()=> location.href = "./index.html";

    document.getElementById("share").onclick = async ()=>{
      try{
        await navigator.clipboard.writeText(location.href);
        alert("Link kopiert.");
      }catch(e){
        alert("Hier ist der Link:\n" + location.href);
      }
    };

    const send = document.getElementById("sendReply");
    if(send){
      send.onclick = ()=>{
        const val = (document.getElementById("replyInput").value||"").trim();
        if(!val){ alert("Schreib wenigstens ein Wort."); return; }
        localStorage.setItem("ok_last_reply", JSON.stringify({at:Date.now(), text:val}));
        alert("Antwort gespeichert (Demo). Sp√§ter geht das als echte R√ºckpost raus.");
        document.getElementById("replyInput").value="";
      };
    }
  })();
</script>
</body>
</html>
