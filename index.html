<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OnlyKeks ‚Äì Post, die schmeckt</title>
  <meta name="description" content="Post, die schmeckt ‚Äì und zur√ºckkommt. Schick ‚Äône Nachricht als Keks. QR-Code bringt dir ‚Äône echte Antwort zur√ºck." />
  <meta name="theme-color" content="#ff4fa3" />
  <meta name="robots" content="index,follow" />

  <meta property="og:title" content="OnlyKeks ‚Äì Post, die schmeckt" />
  <meta property="og:description" content="Post, die schmeckt ‚Äì und zur√ºckkommt. Keks mit Message. QR scan. Antwort zur√ºck." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/img/og.jpg" />
  <meta property="og:url" content="./" />

  <link rel="preload" as="video" href="assets/img/video/intro.mp4" type="video/mp4" />
  <link rel="icon" href="assets/img/favicon.png" />

  <style>
    :root{
      --bg:#ffffff;
      --ink:#0f172a;
      --muted:#475569;
      --line:rgba(15,23,42,.10);
      --card:#ffffff;
      --shadow: 0 10px 30px rgba(2,6,23,.06);
      --shadow2: 0 6px 18px rgba(2,6,23,.08);

      --pink:#ff4fa3;
      --pink2:#ff7bc0;

      /* Schoko-Vanille Basis + Touch Deko-Chichi */
      --vanilla:#fff4e6;
      --cream:#fff7fb;
      --choco:#4b2a1b;
      --choco2:#7a3f27;

      --vip:#0b0b0f;
      --gold:#d7b56d;

      --r:22px;
      --max: 1080px;
      --pad: 20px;
      --h1: clamp(34px, 5vw, 56px);
      --h2: clamp(24px, 3.6vw, 34px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      background:
        radial-gradient(900px 420px at 15% 0%, rgba(255,79,163,.12), transparent 55%),
        radial-gradient(740px 400px at 92% 10%, rgba(255,123,192,.12), transparent 55%),
        linear-gradient(180deg, #fff 0%, var(--cream) 52%, #fff 100%);
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{max-width:var(--max); margin:0 auto; padding: 0 var(--pad);}

    /* Keksregen: Fortnite-Rarity */
    .rain{position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden;}
    .drop{
      position:absolute; top:-14vh;
      font-size:16px;
      opacity:.18;
      transform: translateY(0) rotate(0deg);
      animation: fall linear infinite;
      will-change: transform;
      filter: blur(.05px);
    }
    .drop.common{opacity:.14}
    .drop.rare{opacity:.18}
    .drop.epic{opacity:.22}
    .drop.legendary{opacity:.24; text-shadow: 0 0 18px rgba(215,181,109,.25)}
    @keyframes fall{
      to{ transform: translateY(125vh) rotate(360deg); }
    }
    @media (prefers-reduced-motion: reduce){ .drop{display:none} }

    .topbar, main, footer{position:relative; z-index:1}
    .topbar{
      position:sticky; top:0; z-index:40;
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,.78);
      border-bottom:1px solid var(--line);
    }
    .topbar .inner{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px var(--pad);
      max-width:var(--max); margin:0 auto;
    }
    .brand{
      display:flex; gap:10px; align-items:center; text-decoration:none;
      font-weight:900; letter-spacing:-.02em;
    }
    .brand .logo{
      width:34px; height:34px; border-radius: 12px;
      background:
        radial-gradient(12px 12px at 30% 30%, rgba(255,255,255,.9), transparent 60%),
        linear-gradient(135deg, var(--pink), var(--pink2));
      box-shadow: var(--shadow2);
      border:1px solid rgba(255,255,255,.7);
    }
    nav{display:flex; gap:10px; align-items:center}
    nav a{
      text-decoration:none;
      padding: 10px 12px;
      border-radius: 999px;
      color: rgba(15,23,42,.78);
      font-weight:800;
      font-size: 14px;
    }
    nav a:hover{background: rgba(15,23,42,.04)}
    @media (max-width: 920px){ nav{display:none} }

    /* CTA mit Zuckerguss-Rahmen */
    .cta{
      position:relative;
      display:inline-flex; align-items:center; justify-content:center;
      padding: 14px 18px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#fff;
      text-decoration:none;
      font-weight:1000;
      box-shadow: var(--shadow);
      border: 0;
      cursor:pointer;
    }
    .cta::before{
      content:"";
      position:absolute; inset:-2px;
      border-radius: 999px;
      background:
        radial-gradient(10px 10px at 20% 20%, rgba(255,255,255,.9), transparent 55%),
        radial-gradient(12px 12px at 80% 30%, rgba(255,255,255,.8), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.0));
      pointer-events:none;
      mix-blend-mode: screen;
      opacity:.68;
    }
    .cta.secondary{
      background: #fff;
      color: var(--ink);
      border:1px solid var(--line);
      box-shadow: none;
    }
    .cta.secondary::before{opacity:.35}

    .card{
      background: rgba(255,255,255,.84);
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }

    .hero{padding: 34px 0 18px;}
    .heroGrid{
      display:grid; gap:18px;
      grid-template-columns: 1.2fr .8fr;
      align-items:stretch;
    }
    @media (max-width: 920px){ .heroGrid{grid-template-columns: 1fr} }

    .heroCard{padding: 24px;}
    .kicker{
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,79,163,.25);
      background: rgba(255,79,163,.08);
      font-weight:1000;
      color: rgba(255,79,163,.95);
      font-size: 13px;
      margin-bottom: 14px;
    }
    h1{font-size:var(--h1); line-height:1.03; margin:0 0 10px; letter-spacing:-.03em;}
    .sub{font-size: 17px; color: rgba(15,23,42,.78); margin: 0 0 16px; line-height:1.4;}

    .chipRow{display:flex; flex-wrap:wrap; gap:10px; margin: 12px 0 18px}
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.78);
      font-weight:850;
      font-size: 13px;
      color: rgba(15,23,42,.8);
    }
    .heroActions{display:flex; gap:12px; flex-wrap:wrap; align-items:center}

    .trustbar{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    @media (max-width: 920px){ .trustbar{grid-template-columns: repeat(2,1fr)} }
    .trust{
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.84);
    }
    .trust b{display:block; font-size: 14px; margin-bottom: 4px}
    .trust span{color: rgba(15,23,42,.65); font-size: 13px}

    .visual{
      overflow:hidden;
      position:relative;
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height: 320px;
    }

    /* Hero "Loop" ohne Video: animiertes Panel */
    .loopFrame{
      position:relative;
      border-radius: 22px;
      border:1px solid rgba(15,23,42,.12);
      overflow:hidden;
      aspect-ratio: 16/10;
      background:
        radial-gradient(320px 160px at 20% 20%, rgba(255,79,163,.14), transparent 60%),
        radial-gradient(300px 170px at 90% 35%, rgba(255,123,192,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.6));
    }
    .loopAnim{
      position:absolute; inset:0;
      background:
        linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent);
      transform: translateX(-60%);
      animation: shimmer 2.6s linear infinite;
      opacity:.6;
    }
    @keyframes shimmer{
      to{ transform: translateX(140%); }
    }
    .loopBadge{
      position:absolute;
      left:12px; bottom:12px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.78);
      border:1px solid rgba(15,23,42,.10);
      font-weight:1000;
      font-size: 13px;
      color: rgba(15,23,42,.82);
      backdrop-filter: blur(8px);
    }
    .loopShot{
      position:absolute; inset:18px;
      border-radius: 18px;
      border:1px dashed rgba(15,23,42,.18);
      display:flex; align-items:center; justify-content:center;
      font-weight:1000;
      color: rgba(15,23,42,.55);
      background:
        radial-gradient(260px 130px at 30% 30%, rgba(122,63,39,.12), transparent 60%),
        radial-gradient(260px 140px at 80% 60%, rgba(255,79,163,.10), transparent 60%);
    }

    .mini{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .mini .tile{
      border-radius: 18px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.84);
      padding: 12px;
      font-weight:1000;
      color: rgba(15,23,42,.78);
    }
    .mini .tile span{
      display:block;
      margin-top: 4px;
      font-weight:750;
      color: rgba(15,23,42,.6);
      font-size: 13px;
    }

    section{padding: 22px 0}
    h2{font-size:var(--h2); margin: 0 0 10px; letter-spacing:-.02em;}
    .muted{color: rgba(15,23,42,.65); line-height:1.45}

    /* Configurator */
    .configGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 920px){ .configGrid{grid-template-columns: 1fr} }

    .panel{padding: 18px;}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    label{display:block; font-weight:900; font-size: 13px; color: rgba(15,23,42,.78); margin: 12px 0 6px}
    input[type="text"], textarea, select{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.14);
      background: rgba(255,255,255,.92);
      outline:none;
      font-weight:750;
      color: rgba(15,23,42,.9);
    }
    textarea{min-height: 92px; resize: vertical}
    .hint2{font-size: 12px; color: rgba(15,23,42,.58); margin-top: 6px}

    .pill{
      border:1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.84);
      border-radius: 999px;
      padding: 10px 12px;
      font-weight:950;
      cursor:pointer;
      user-select:none;
    }
    .pill[aria-pressed="true"]{
      border-color: rgba(255,79,163,.35);
      background: rgba(255,79,163,.10);
      color: rgba(255,79,163,.98);
    }

    .rarityTag{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.82);
      font-weight:1000;
      font-size: 12px;
    }
    .rarityTag.common{border-color: rgba(15,23,42,.12)}
    .rarityTag.rare{border-color: rgba(0,170,255,.25)}
    .rarityTag.epic{border-color: rgba(160,80,255,.25)}
    .rarityTag.legendary{border-color: rgba(215,181,109,.45); color: rgba(120,85,10,.9)}

    .preview{
      position:relative;
      border-radius: 22px;
      border:1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.70);
      overflow:hidden;
      padding: 16px;
    }
    .cookieWrap{
      border-radius: 20px;
      border:1px dashed rgba(15,23,42,.18);
      background:
        radial-gradient(280px 140px at 20% 20%, rgba(255,79,163,.10), transparent 60%),
        radial-gradient(260px 150px at 85% 35%, rgba(122,63,39,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.6));
      padding: 14px;
      min-height: 300px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .qrBox{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
      padding-top: 10px;
    }
    .qrCanvas{
      width: 120px; height:120px;
      border-radius: 16px;
      border:1px solid rgba(15,23,42,.12);
      background: #fff;
      padding: 8px;
    }
    .smallActions{display:flex; gap:10px; flex-wrap:wrap;}

    /* Intro Overlay */
    .intro{
      position:fixed;
      inset:0;
      z-index:99999;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:auto;
    }
    .intro video{width:100%;height:100%;object-fit:cover;display:block;background:#000;}
    .intro .skip{
      position:absolute; top:16px; right:16px;
      z-index:100000;
      pointer-events:auto;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      background:rgba(0,0,0,.35);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
      backdrop-filter: blur(8px);
    }
    .intro .hint{
      position:absolute; bottom:16px; left:16px; right:16px;
      color:rgba(255,255,255,.85);
      font-weight:900;
      font-size:13px;
      text-align:center;
      pointer-events:none;
      text-shadow: 0 8px 20px rgba(0,0,0,.55);
    }

    footer{padding: 30px 0 50px; color: rgba(15,23,42,.62); font-size: 14px;}
    .footRow{display:flex; gap:14px; flex-wrap:wrap; margin-top: 10px}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js" defer></script>
</head>

<body>
  <div class="rain" id="rain" aria-hidden="true"></div>

  <div class="intro" id="intro" onclick="window.__introTap && window.__introTap(event)">
    <button class="skip" id="introSkip" type="button" onclick="window.__skipIntro && window.__skipIntro()">Skip</button>
    <video id="introVideo" playsinline muted preload="auto" poster="assets/intro/poster.jpg">
      <source src="assets/img/video/intro.mp4" type="video/mp4" />
    </video>
    <div class="hint">Wenn Autoplay zickt: Tippen = Start. ESC = raus.</div>
  </div>

  <div class="topbar">
    <div class="inner">
      <a class="brand" href="./">
        <div class="logo" aria-hidden="true"></div>
        <div>OnlyKeks<br><span style="font-weight:700;color:rgba(15,23,42,.55);font-size:12px">Post, die schmeckt</span></div>
      </a>
      <nav aria-label="Navigation">
        <a href="#config">Konfigurator</a>
        <a href="#checkout">Checkout</a>
        <a href="#faq">FAQ</a>
      </nav>
      <button class="cta" type="button" onclick="location.hash='#config'">Jetzt gestalten</button>
    </div>
  </div>

  <main>
    <div class="wrap hero" id="top">
      <div class="heroGrid">
        <div class="card heroCard">
          <div class="kicker">Post, die schmeckt ‚Äì und zur√ºckkommt.</div>
          <h1>Schick ‚Äône s√º√üe Botschaft.<br>Hol dir ‚Äône Antwort zur√ºck.</h1>
          <p class="sub">Du schreibst die Message. Wir packen sie auf den Keks. Der QR bringt dich zur internen Preview ‚Äì sauberer Loop, ohne Account.</p>

          <div class="chipRow">
            <div class="chip">Preview-Link per QR</div>
            <div class="chip">Fortnite-Rarity Packs</div>
            <div class="chip">Schoko + Vanille + Deko</div>
            <div class="chip">Draft wird gespeichert</div>
          </div>

          <div class="heroActions">
            <a class="cta" href="#config">Keks gestalten</a>
            <button class="cta secondary" type="button" onclick="location.hash='#config'">Beispiel ansehen</button>
          </div>

          <div class="trustbar">
            <div class="trust"><b>Kein Account</b><span>Einfach gestalten & teilen.</span></div>
            <div class="trust"><b>QR pro Keks</b><span>Geht auf interne Preview.</span></div>
            <div class="trust"><b>Privat</b><span>Local Draft ‚Äì keine Datenweitergabe.</span></div>
            <div class="trust"><b>Boss-Mode</b><span>Rarity/Skins/Token vorbereitet.</span></div>
          </div>
        </div>

        <div class="card visual">
          <div class="loopFrame">
            <div class="loopShot">Loop Visual (Auto-Animation)<br><span style="font-weight:800; font-size:13px; opacity:.8;">Sp√§ter echtes MP4 hier rein</span></div>
            <div class="loopAnim"></div>
            <div class="loopBadge">Live Loop: Keks ‚Üí QR ‚Üí Preview</div>
          </div>
          <div class="mini">
            <div class="tile">Preview<span>QR scannt ‚Üí preview.html l√§dt Draft.</span></div>
            <div class="tile">Rarity<span>Packs sind nach Seltenheit gestaffelt.</span></div>
          </div>
        </div>
      </div>
    </div>

    <section id="config">
      <div class="wrap">
        <h2>Konfigurator</h2>
        <p class="muted">MVP: Shape + Sticker/Emojis + Zuckerguss/Glasur + Schokoguss + Streusel. QR zeigt auf interne Preview, verstehste.</p>

        <div class="configGrid">
          <div class="card panel">
            <label for="msg">Deine Message</label>
            <textarea id="msg" maxlength="220" placeholder="z.B. 'Du fehlst. Ruf an. üç™‚ù§Ô∏è'"></textarea>
            <div class="hint2"><span id="msgCount">0</span>/220 Zeichen</div>

            <label>Form</label>
            <div class="row" id="shapeRow">
              <div class="pill" data-shape="circle" aria-pressed="true">Kreis</div>
              <div class="pill" data-shape="heart" aria-pressed="false">Herz</div>
              <div class="pill" data-shape="star" aria-pressed="false">Stern</div>
              <div class="pill" data-shape="smiley" aria-pressed="false">Smiley</div>
            </div>

            <label for="glaze">Glasur / Zuckerguss</label>
            <select id="glaze">
              <option value="vanilla">Vanille</option>
              <option value="pink">Deko Pink</option>
              <option value="white">Wei√ü</option>
              <option value="choco">Schoko</option>
              <option value="vip">VIP Schwarz/Gold</option>
            </select>

            <label for="drizzle">Schokoguss</label>
            <select id="drizzle">
              <option value="none">Keiner</option>
              <option value="light">Leicht</option>
              <option value="heavy">Viel (Boss)</option>
            </select>

            <label>Streusel</label>
            <div class="row" id="sprinkleRow">
              <div class="pill" data-sprinkle="none" aria-pressed="true">Keine</div>
              <div class="pill" data-sprinkle="sugarHearts" aria-pressed="false">Zuckerherzen</div>
              <div class="pill" data-sprinkle="sugarPearls" aria-pressed="false">Zuckerkugeln</div>
              <div class="pill" data-sprinkle="chocoSprinkles" aria-pressed="false">Schokostreusel</div>
              <div class="pill" data-sprinkle="rainbow" aria-pressed="false">Bunte Streusel</div>
            </div>

            <label>Sticker / Emoji</label>
            <div class="row" id="stickerRow">
              <div class="pill" data-sticker="none" aria-pressed="true">Keiner</div>
              <div class="pill" data-sticker="‚ù§Ô∏è" aria-pressed="false">‚ù§Ô∏è</div>
              <div class="pill" data-sticker="‚ú®" aria-pressed="false">‚ú®</div>
              <div class="pill" data-sticker="üç´" aria-pressed="false">üç´</div>
              <div class="pill" data-sticker="üíã" aria-pressed="false">üíã</div>
              <div class="pill" data-sticker="üëë" aria-pressed="false">üëë</div>
              <div class="pill" data-sticker="üíé" aria-pressed="false">üíé</div>
            </div>

            <label for="pack">Pack (Rarity)</label>
            <select id="pack">
              <option value="schnell">Schnell ‚Äì Common</option>
              <option value="normal">Normal ‚Äì Rare</option>
              <option value="premium">Premium ‚Äì Epic</option>
              <option value="boss">Boss ‚Äì Legendary</option>
            </select>

            <div style="margin-top:10px">
              <span class="rarityTag" id="rarityTag">Rarity: Common</span>
              <span class="rarityTag" id="priceTag" style="margin-left:8px;">Preis: ‚Äî</span>
            </div>

            <div style="height:12px"></div>
            <div class="row">
              <button class="cta" type="button" id="btnCopyLink">Preview-Link kopieren</button>
              <button class="cta secondary" type="button" id="btnReset">Reset</button>
            </div>
            <div class="hint2" id="saveHint">Draft: wird gespeichert‚Ä¶</div>
          </div>

          <div class="card preview">
            <div class="cookieWrap">
              <svg id="cookieSvg" width="360" height="260" viewBox="0 0 360 260" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Keks Vorschau">
                <defs>
                  <linearGradient id="cookieBase" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0" stop-color="#e2b17a"/>
                    <stop offset="1" stop-color="#b87945"/>
                  </linearGradient>
                  <linearGradient id="chocoDrip" x1="0" y1="0" x2="1" y2="0">
                    <stop offset="0" stop-color="#4b2a1b"/>
                    <stop offset="1" stop-color="#7a3f27"/>
                  </linearGradient>
                  <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="rgba(2,6,23,.20)"/>
                  </filter>
                </defs>

                <g filter="url(#softShadow)" id="shapeLayer"></g>
                <g id="glazeLayer"></g>
                <g id="dripLayer"></g>
                <g id="sprinkleLayer"></g>
                <g id="stickerLayer"></g>
                <g id="textLayer"></g>
              </svg>
            </div>

            <div class="qrBox">
              <canvas class="qrCanvas" id="qr"></canvas>
              <div>
                <div style="font-weight:1000">Interne Preview</div>
                <div class="hint2" id="qrUrl" style="max-width:520px; word-break:break-all;"></div>
                <div class="smallActions" style="margin-top:10px">
                  <button class="cta secondary" type="button" id="btnCopyQrUrl">Link kopieren</button>
                  <button class="cta secondary" type="button" id="btnDownloadQr">QR speichern</button>
                </div>
              </div>
            </div>

            <div class="hint2">Hinweis: Preview nutzt localStorage. Wenn du den Link auf ‚Äônem anderen Ger√§t √∂ffnest, ist der Draft dort nicht da (kommt sp√§ter mit Server/Token), verstehste.</div>
          </div>
        </div>
      </div>
    </section>

    <section id="checkout">
      <div class="wrap">
        <h2>Checkout</h2>
        <p class="muted">N√§chster Step: Preise ‚Üí Stripe ‚Üí Partner. Aktuell: Preview + Rarity + QR = funktionierender MVP-Beweis.</p>
      </div>
    </section>

    <section id="faq">
      <div class="wrap">
        <h2>FAQ</h2>
        <p class="muted">
          <b>Warum Preview intern?</b><br>
          Damit wir sofort sauber testen k√∂nnen, ohne Backend. Danach machen wir‚Äôs ‚Äúecht‚Äù mit Token/DB.
        </p>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">
      ¬© 2025 OnlyKeks
      <div class="footRow">
        <a href="privacy.html">Wie wir mit Daten umgehen</a>
        <a href="#top">Top</a>
      </div>
    </div>
  </footer>

  <script>
    (function(){
      const $ = (s, r=document)=>r.querySelector(s);

      const intro = $('#intro');
      const vid   = $('#introVideo');
      const skip  = $('#introSkip');

      if(!intro || !vid || !skip) return;

      function hideIntro(){
        intro.style.display = 'none';
        intro.setAttribute('aria-hidden','true');
        try{ vid.pause(); }catch(e){}
      }

      window.__skipIntro = hideIntro;

      window.__introTap = async function(ev){
        if(ev && ev.target && ev.target.id === 'introSkip') return;
        try{ await vid.play(); }catch(e){ hideIntro(); }
      };

      skip.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); hideIntro(); }, true);
      skip.addEventListener('touchstart', (e)=>{ e.preventDefault(); e.stopPropagation(); hideIntro(); }, {passive:false, capture:true});

      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') hideIntro(); });

      vid.addEventListener('ended', hideIntro);
      setTimeout(()=>{ if(intro.style.display !== 'none') hideIntro(); }, 9000);

      (async ()=>{ try{ await vid.play(); }catch(e){} })();
    })();
  </script>

  <script>
    const CFG = {
      previewPage: "preview.html",
      draftKey: "onlykeks_draft_v2",
      rainCount: 26
    };

    // Fortnite-Rarity Setup
    const PACKS = {
      schnell:  { rarity:"common",    label:"Common",    priceCents: 399,  tokenHint:"10 Token" },
      normal:   { rarity:"rare",      label:"Rare",      priceCents: 699,  tokenHint:"25 Token" },
      premium:  { rarity:"epic",      label:"Epic",      priceCents: 1299, tokenHint:"60 Token" },
      boss:     { rarity:"legendary", label:"Legendary", priceCents: 2499, tokenHint:"150 Token" }
    };

    function moneyEUR(cents){
      const v = (cents/100).toFixed(2).replace('.',',');
      return v + " ‚Ç¨";
    }

    // Keksregen: variable Gr√∂√üen + seltene "Legendary" Drops
    (function initRain(){
      const rain = document.getElementById('rain');
      if(!rain) return;

      const drops = [
        {t:"üç™", w:0.68},
        {t:"üç´", w:0.14},
        {t:"‚ú®", w:0.10},
        {t:"üíé", w:0.05},
        {t:"üëë", w:0.03}
      ];

      function pickWeighted(){
        const r = Math.random();
        let acc=0;
        for(const d of drops){
          acc += d.w;
          if(r<=acc) return d.t;
        }
        return "üç™";
      }

      function rarityRoll(){
        const r = Math.random();
        if(r < 0.72) return "common";
        if(r < 0.92) return "rare";
        if(r < 0.985) return "epic";
        return "legendary";
      }

      for(let i=0;i<CFG.rainCount;i++){
        const d = document.createElement('div');
        const rar = rarityRoll();
        d.className = 'drop ' + rar;
        d.textContent = pickWeighted();

        const left = Math.random()*100;
        const dur = 7 + Math.random()*12;
        const delay = -Math.random()*dur;
        const size = (rar==="legendary" ? 26 : rar==="epic" ? 22 : rar==="rare" ? 18 : 14) + Math.random()*10;

        d.style.left = left + "vw";
        d.style.animationDuration = dur + "s";
        d.style.animationDelay = delay + "s";
        d.style.fontSize = size + "px";

        rain.appendChild(d);
      }
    })();

    // Konfigurator
    (function(){
      const $ = (s, r=document)=>r.querySelector(s);
      const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

      const msg = $('#msg');
      const msgCount = $('#msgCount');
      const glaze = $('#glaze');
      const drizzle = $('#drizzle');
      const pack = $('#pack');

      const rarityTag = $('#rarityTag');
      const priceTag = $('#priceTag');

      const qrCanvas = $('#qr');
      const qrUrlEl = $('#qrUrl');

      const btnCopyLink = $('#btnCopyLink');
      const btnReset = $('#btnReset');
      const btnCopyQrUrl = $('#btnCopyQrUrl');
      const btnDownloadQr = $('#btnDownloadQr');

      const saveHint = $('#saveHint');

      const shapeRow = $('#shapeRow');
      const sprinkleRow = $('#sprinkleRow');
      const stickerRow = $('#stickerRow');

      const shapeLayer = document.getElementById('shapeLayer');
      const glazeLayer = document.getElementById('glazeLayer');
      const dripLayer = document.getElementById('dripLayer');
      const sprinkleLayer = document.getElementById('sprinkleLayer');
      const stickerLayer = document.getElementById('stickerLayer');
      const textLayer = document.getElementById('textLayer');

      let state = {
        rid: cryptoRandomId(),
        message: "",
        shape: "circle",
        glaze: "vanilla",
        drizzle: "light",
        sprinkle: "none",
        sticker: "none",
        pack: "schnell"
      };

      function cryptoRandomId(){
        try{
          const a = new Uint8Array(8);
          crypto.getRandomValues(a);
          return Array.from(a).map(x=>x.toString(16).padStart(2,'0')).join('');
        }catch(e){
          return String(Date.now());
        }
      }

      function pressGroup(rowEl, attr, value){
        if(!rowEl) return;
        $$('.pill', rowEl).forEach(p=>{
          const v = p.getAttribute(attr);
          p.setAttribute('aria-pressed', v === value ? 'true':'false');
        });
      }

      function pickFromRow(rowEl, attr, key){
        if(!rowEl) return;
        rowEl.addEventListener('click', (e)=>{
          const t = e.target.closest('.pill');
          if(!t) return;
          const v = t.getAttribute(attr);
          state[key] = v;
          pressGroup(rowEl, attr, v);
          renderAll();
          persist();
        });
      }

      function clampText(text, max=220){
        text = (text || "").trim();
        if(text.length > max) text = text.slice(0,max);
        return text;
      }

      function persist(){
        try{
          localStorage.setItem(CFG.draftKey, JSON.stringify(state));
          saveHint.textContent = "Draft gespeichert.";
          setTimeout(()=>{ saveHint.textContent = "Draft: wird gespeichert‚Ä¶"; }, 1200);
        }catch(e){}
      }

      function load(){
        try{
          const raw = localStorage.getItem(CFG.draftKey);
          if(!raw) return;
          const d = JSON.parse(raw);
          if(!d || typeof d !== "object") return;
          state = { ...state, ...d };
          if(!state.rid) state.rid = cryptoRandomId();
        }catch(e){}
      }

      function previewUrl(){
        const u = new URL(CFG.previewPage, location.href);
        u.searchParams.set('rid', state.rid);
        return u.toString();
      }

      function glazeColors(kind){
        switch(kind){
          case "pink": return { fill:"#ff7bc0", stroke:"rgba(255,79,163,.55)" };
          case "vanilla": return { fill:"#fff1d6", stroke:"rgba(180,120,69,.30)" };
          case "choco": return { fill:"#5a2f1e", stroke:"rgba(122,63,39,.55)" };
          case "white": return { fill:"#ffffff", stroke:"rgba(15,23,42,.18)" };
          case "vip": return { fill:"#0b0b0f", stroke:"#d7b56d" };
          default: return { fill:"#fff1d6", stroke:"rgba(180,120,69,.30)" };
        }
      }

      function packMeta(){
        return PACKS[state.pack] || PACKS.schnell;
      }

      function drawBaseShape(){
        shapeLayer.innerHTML = "";
        const s = state.shape;

        let el;
        if(s === "circle"){
          el = svgEl('circle', { cx:180, cy:130, r:92, fill:"url(#cookieBase)", stroke:"rgba(15,23,42,.10)", "stroke-width":"2" });
        } else if(s === "heart"){
          el = svgEl('path', {
            d:"M180 212 C120 172 96 140 96 112 C96 86 114 68 140 68 C160 68 172 80 180 92 C188 80 200 68 220 68 C246 68 264 86 264 112 C264 140 240 172 180 212 Z",
            fill:"url(#cookieBase)", stroke:"rgba(15,23,42,.10)", "stroke-width":"2"
          });
        } else if(s === "star"){
          el = svgEl('path', {
            d:"M180 52 L203 98 L254 104 L217 136 L226 186 L180 160 L134 186 L143 136 L106 104 L157 98 Z",
            fill:"url(#cookieBase)", stroke:"rgba(15,23,42,.10)", "stroke-width":"2"
          });
        } else if(s === "smiley"){
          el = svgEl('circle', { cx:180, cy:130, r:92, fill:"url(#cookieBase)", stroke:"rgba(15,23,42,.10)", "stroke-width":"2" });
          const eye1 = svgEl('circle',{cx:148, cy:118, r:8, fill:"rgba(15,23,42,.35)"});
          const eye2 = svgEl('circle',{cx:212, cy:118, r:8, fill:"rgba(15,23,42,.35)"});
          const mouth = svgEl('path',{d:"M145 150 C160 175 200 175 215 150", fill:"none", stroke:"rgba(15,23,42,.35)", "stroke-width":"8", "stroke-linecap":"round"});
          shapeLayer.appendChild(el);
          shapeLayer.appendChild(eye1);
          shapeLayer.appendChild(eye2);
          shapeLayer.appendChild(mouth);
          addChips();
          return;
        }
        shapeLayer.appendChild(el);
        addChips();

        function addChips(){
          const chips = [
            [140,105,10],[210,100,7],[120,150,8],[235,155,11],[175,175,7],[160,85,6]
          ];
          chips.forEach(([x,y,r])=>{
            const c = svgEl('circle',{cx:x, cy:y, r:r, fill:"rgba(75,42,27,.38)"});
            shapeLayer.appendChild(c);
          });
        }
      }

      function drawGlaze(){
        glazeLayer.innerHTML = "";
        const c = glazeColors(state.glaze);

        let el;
        if(state.shape === "circle" || state.shape === "smiley"){
          el = svgEl('circle', { cx:180, cy:130, r:76, fill:c.fill, stroke:c.stroke, "stroke-width":"3", opacity:"0.95" });
        } else if(state.shape === "heart"){
          el = svgEl('path', {
            d:"M180 198 C130 168 112 142 112 120 C112 98 126 84 146 84 C162 84 172 94 180 106 C188 94 198 84 214 84 C234 84 248 98 248 120 C248 142 230 168 180 198 Z",
            fill:c.fill, stroke:c.stroke, "stroke-width":"3", opacity:"0.95"
          });
        } else if(state.shape === "star"){
          el = svgEl('path', {
            d:"M180 70 L198 106 L238 110 L208 134 L216 172 L180 152 L144 172 L152 134 L122 110 L162 106 Z",
            fill:c.fill, stroke:c.stroke, "stroke-width":"3", opacity:"0.95"
          });
        }
        glazeLayer.appendChild(el);

        if(state.glaze === "vip"){
          const ring = svgEl('circle',{cx:180, cy:130, r:78, fill:"none", stroke:"#d7b56d", "stroke-width":"4", opacity:"0.95"});
          glazeLayer.appendChild(ring);
        }
      }

      function drawDrip(){
        dripLayer.innerHTML = "";
        const mode = state.drizzle;
        if(mode === "none") return;

        const op = mode === "heavy" ? 0.40 : 0.26;
        const w1 = mode === "heavy" ? 12 : 10;
        const w2 = mode === "heavy" ? 10 : 8;

        const path1 = svgEl('path',{
          d:"M120 94 C140 86 158 110 176 98 C196 84 214 110 238 96",
          fill:"none", stroke:"url(#chocoDrip)", "stroke-width":String(w1), "stroke-linecap":"round",
          opacity:String(op)
        });
        const path2 = svgEl('path',{
          d:"M132 126 C150 110 168 140 186 124 C206 106 226 140 244 122",
          fill:"none", stroke:"url(#chocoDrip)", "stroke-width":String(w2), "stroke-linecap":"round",
          opacity:String(op)
        });
        dripLayer.appendChild(path1);
        dripLayer.appendChild(path2);
      }

      function drawSprinkles(){
        sprinkleLayer.innerHTML = "";
        const kind = state.sprinkle;
        if(kind === "none") return;

        const pts = [
          [140,120],[165,105],[196,112],[215,132],[175,150],[150,150],[205,155],[185,170]
        ];

        pts.forEach(([x,y], i)=>{
          if(kind === "sugarHearts"){
            const t = svgEl('text',{x:x, y:y, "font-size":"16", "text-anchor":"middle"});
            t.textContent = "‚ù§";
            sprinkleLayer.appendChild(t);
          } else if(kind === "sugarPearls"){
            const c = svgEl('circle',{cx:x, cy:y-4, r:4.8, fill:"rgba(255,255,255,.85)", stroke:"rgba(15,23,42,.10)", "stroke-width":"1"});
            sprinkleLayer.appendChild(c);
          } else if(kind === "chocoSprinkles"){
            const r = svgEl('rect',{x:x-4, y:y-8, width:10, height:4, rx:2, fill:"rgba(75,42,27,.45)"});
            sprinkleLayer.appendChild(r);
          } else if(kind === "rainbow"){
            const colors = ["rgba(255,79,163,.75)","rgba(255,210,95,.75)","rgba(120,205,255,.70)","rgba(160,80,255,.65)"];
            const r = svgEl('rect',{x:x-4, y:y-8, width:10, height:4, rx:2, fill: colors[i%colors.length]});
            sprinkleLayer.appendChild(r);
          }
        });
      }

      function drawSticker(){
        stickerLayer.innerHTML = "";
        const s = state.sticker;
        if(!s || s === "none") return;

        const t = svgEl('text',{x:252, y:88, "font-size":"30", "text-anchor":"middle"});
        t.textContent = s;
        stickerLayer.appendChild(t);
      }

      function drawText(){
        textLayer.innerHTML = "";
        const text = clampText(state.message, 220);
        if(!text) return;

        const lines = wrapLines(text, 18).slice(0,4);
        const startY = 126 - (lines.length-1)*14;

        const fill = (state.glaze === "vip") ? "#d7b56d" : "rgba(15,23,42,.78)";
        lines.forEach((ln, idx)=>{
          const t = svgEl('text',{
            x:180, y:startY + idx*28,
            "font-size":"18",
            "font-weight":"900",
            "text-anchor":"middle",
            fill
          });
          t.textContent = ln;
          textLayer.appendChild(t);
        });
      }

      function wrapLines(text, maxChars){
        const words = text.split(/\s+/);
        const lines = [];
        let cur = "";
        for(const w of words){
          const next = cur ? (cur + " " + w) : w;
          if(next.length <= maxChars){
            cur = next;
          }else{
            if(cur) lines.push(cur);
            cur = w;
          }
        }
        if(cur) lines.push(cur);
        return lines;
      }

      function svgEl(tag, attrs){
        const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
        for(const k in attrs) el.setAttribute(k, attrs[k]);
        return el;
      }

      async function renderQr(){
        const url = previewUrl();
        qrUrlEl.textContent = url;

        if(!window.QRCode){
          setTimeout(renderQr, 200);
          return;
        }
        try{
          await QRCode.toCanvas(qrCanvas, url, { margin: 1, width: 120 });
        }catch(e){}
      }

      function renderMeta(){
        const p = packMeta();
        rarityTag.className = "rarityTag " + p.rarity;
        rarityTag.textContent = "Rarity: " + p.label;

        priceTag.className = "rarityTag " + p.rarity;
        priceTag.textContent = "Preis: " + moneyEUR(p.priceCents) + " (" + p.tokenHint + ")";
      }

      function renderAll(){
        msgCount.textContent = (msg.value || "").length;
        drawBaseShape();
        drawGlaze();
        drawDrip();
        drawSprinkles();
        drawSticker();
        drawText();
        renderMeta();
        renderQr();
      }

      function syncUI(){
        msg.value = state.message || "";
        glaze.value = state.glaze || "vanilla";
        drizzle.value = state.drizzle || "light";
        pack.value = state.pack || "schnell";

        pressGroup(shapeRow, 'data-shape', state.shape);
        pressGroup(sprinkleRow, 'data-sprinkle', state.sprinkle);
        pressGroup(stickerRow, 'data-sticker', state.sticker);

        msgCount.textContent = (msg.value || "").length;
      }

      msg.addEventListener('input', ()=>{
        state.message = clampText(msg.value, 220);
        renderAll(); persist();
      });

      glaze.addEventListener('change', ()=>{
        state.glaze = glaze.value;
        renderAll(); persist();
      });

      drizzle.addEventListener('change', ()=>{
        state.drizzle = drizzle.value;
        renderAll(); persist();
      });

      pack.addEventListener('change', ()=>{
        state.pack = pack.value;
        renderAll(); persist();
      });

      pickFromRow(shapeRow, 'data-shape', 'shape');
      pickFromRow(sprinkleRow, 'data-sprinkle', 'sprinkle');
      pickFromRow(stickerRow, 'data-sticker', 'sticker');

      btnReset.addEventListener('click', ()=>{
        state = { rid: cryptoRandomId(), message:"", shape:"circle", glaze:"vanilla", drizzle:"light", sprinkle:"none", sticker:"none", pack:"schnell" };
        syncUI(); renderAll(); persist();
      });

      function copyToClipboard(text){
        try{ navigator.clipboard.writeText(text); }
        catch(e){
          const ta = document.createElement('textarea');
          ta.value = text; document.body.appendChild(ta);
          ta.select(); document.execCommand('copy');
          ta.remove();
        }
      }

      btnCopyQrUrl.addEventListener('click', ()=> copyToClipboard(previewUrl()));
      btnCopyLink.addEventListener('click', ()=> copyToClipboard(previewUrl()));

      btnDownloadQr.addEventListener('click', ()=>{
        try{
          const a = document.createElement('a');
          a.download = "onlykeks-preview-qr.png";
          a.href = qrCanvas.toDataURL("image/png");
          a.click();
        }catch(e){}
      });

      // Init
      load();
      syncUI();
      renderAll();
      persist();
    })();
  </script>
</body>
</html>
