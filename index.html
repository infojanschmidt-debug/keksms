<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OnlyKeks ‚Äì Post, die schmeckt</title>
  <meta name="description" content="Schicke s√º√üe Botschaften mit direkter QR-Antwort. Gestalte deinen Keks, verschick ihn ‚Äì und bekomm ‚Äônen Antwort-Keks zur√ºck." />
  <link rel="canonical" href="https://infojanschmidt-debug.github.io/keksms/" />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#ff4fa3" />

  <meta property="og:title" content="OnlyKeks ‚Äì Post, die schmeckt" />
  <meta property="og:description" content="Gestalte deinen Keks + QR-Antwort. Kein Account. Schnell. S√º√ü." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://infojanschmidt-debug.github.io/keksms/" />
  <meta property="og:image" content="https://infojanschmidt-debug.github.io/keksms/assets/img/1000149739.jpg" />

  <style>
    :root{
      --bg:#ffffff;
      --ink:#0b1b2a;
      --muted:#5b6a79;
      --line: rgba(11,27,42,.10);

      --pink:#ff4fa3;
      --pink2:#ff7cc5;
      --pinkSoft: rgba(255,79,163,.10);
      --mint:#27d6a4;
      --amber:#ffb020;

      --shadow: 0 10px 25px rgba(11,27,42,.06);
      --shadow2: 0 14px 34px rgba(11,27,42,.10);
      --radius: 16px;
      --max: 1040px;

      --ease: cubic-bezier(.2,.9,.2,1);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: var(--bg);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{max-width:var(--max); margin:0 auto; padding:0 18px}
    .muted{color:var(--muted)}
    .hr{height:1px;background:var(--line);border:0;margin:18px 0}
    .sr{position:absolute;left:-9999px}

    /* Gate: Seite erst sichtbar wenn Intro done */
    html:not(.appReady) body > *:not(#intro) { visibility: hidden; }

    /* Intro Overlay */
    .intro{
      position:fixed; inset:0; z-index:9999;
      background:#000;
      display:grid; place-items:center;
    }
    .introVid{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      background:#000;
    }
    .introTop{
      position:absolute; inset:0;
      pointer-events:none;
      background: radial-gradient(1200px 600px at 50% 70%, rgba(255,79,163,.14), transparent 55%);
    }
    .introSkip{
      position:absolute; right:14px; top:14px;
      border:1px solid rgba(255,255,255,.25);
      background: rgba(0,0,0,.35);
      color:#fff;
      padding:10px 14px;
      border-radius:999px;
      font-weight:900;
      backdrop-filter: blur(10px);
      cursor:pointer;
      pointer-events:auto;
      transition: transform .12s var(--ease);
    }
    .introSkip:active{transform: translateY(1px)}
    .introPlay{
      position:absolute; left:50%; top:50%;
      transform: translate(-50%,-50%);
      border:1px solid rgba(255,255,255,.25);
      background: rgba(0,0,0,.35);
      color:#fff;
      padding:14px 18px;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
      display:none;
      align-items:center;
      gap:10px;
      pointer-events:auto;
      backdrop-filter: blur(12px);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
    }
    .introPlay.show{display:inline-flex}
    .intro.hide{opacity:0; pointer-events:none; transition: opacity .22s ease}

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      background: rgba(255,255,255,.92);
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(14px);
    }
    .topbar .inner{
      height:66px;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      text-decoration:none;
      min-width: 190px;
    }
    .mark{width:52px;height:52px; filter: drop-shadow(0 10px 18px rgba(11,27,42,.12));}
    .brand strong{display:block; font-size:18px; line-height:1; letter-spacing:-.2px}
    .brand span{display:block; font-size:12.5px; color:var(--muted); margin-top:3px}
    nav{display:flex; gap:8px; align-items:center}
    nav a{
      text-decoration:none;
      font-size:13.5px;
      color:var(--muted);
      padding:10px 10px;
      border-radius:999px;
      transition: background .16s var(--ease), color .16s var(--ease), transform .12s var(--ease);
    }
    nav a:hover{background: rgba(255,79,163,.08); color:var(--ink)}
    nav a:active{transform: translateY(1px)}
    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:12px 16px;
      font-weight:900;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex; align-items:center; justify-content:center;
      gap:10px;
      box-shadow: var(--shadow);
      transition: transform .12s var(--ease), filter .12s var(--ease), background .12s var(--ease);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{transform: translateY(1px)}
    .btn:hover{filter: brightness(.99)}
    .btnPrimary{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      border-color: rgba(255,79,163,.20);
      color:#fff;
      box-shadow: var(--shadow2);
    }
    .btnGhost{background:#fff}
    .btnGhost:hover{background: rgba(0,0,0,.02)}
    .btnSmall{padding:10px 12px; font-size:13px}
    @media (max-width: 820px){
      nav{display:none}
    }

    /* Hero */
    .hero{padding: 18px 0 6px}
    .heroGrid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 18px;
      align-items:start;
    }
    @media (max-width: 920px){ .heroGrid{grid-template-columns:1fr; gap:14px} }

    .panel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background:#fff;
      padding: 16px;
    }
    .kicker{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,79,163,.18);
      background: rgba(255,79,163,.06);
      font-weight:900;
      font-size:12.5px;
    }
    h1{
      margin:12px 0 10px;
      font-size:38px;
      line-height:1.05;
      letter-spacing:-.7px;
    }
    @media (max-width: 520px){ h1{font-size:32px} }
    .sub{
      margin:0 0 14px;
      color:var(--muted);
      line-height:1.55;
      font-size:15.5px;
      max-width: 60ch;
    }

    .trustBar{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 12px;
    }
    .trustItem{
      display:inline-flex; align-items:center; gap:8px;
      font-size:12.8px;
      color:var(--muted);
      border:1px solid var(--line);
      border-radius:999px;
      padding:9px 10px;
      background:#fff;
    }
    .dot{
      width:9px; height:9px; border-radius:50%;
      background: rgba(39,214,164,.95);
      box-shadow: 0 0 0 4px rgba(39,214,164,.14);
    }

    .chips{display:flex; flex-wrap:wrap; gap:10px; margin: 10px 0 14px}
    .chip{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      transition: background .12s var(--ease), transform .12s var(--ease);
    }
    .chip:hover{background: rgba(0,0,0,.02)}
    .chip:active{transform: translateY(1px)}
    .heroActions{display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px}

    /* Media */
    .media{
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      background:#fff;
      min-height: 380px;
      position:relative;
    }
    .media img, .media video{width:100%; height:100%; object-fit:cover; display:block}
    .badge{
      position:absolute; left:12px; top:12px;
      background: rgba(255,255,255,.92);
      border:1px solid var(--line);
      border-radius:999px;
      padding:8px 10px;
      font-weight:900;
      font-size:12.5px;
      backdrop-filter: blur(10px);
    }

    /* Sections */
    .section{padding: 10px 0}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    @media (max-width: 920px){ .grid2{grid-template-columns:1fr} }
    h2{margin:0 0 8px; font-size:18px}
    ul{margin:10px 0 0; padding-left: 18px; color:var(--muted); line-height:1.55}
    li{margin:8px 0}

    /* Flow */
    .flowHead{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .steps{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .step{
      width:30px; height:30px;
      display:grid; place-items:center;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      font-weight:900;
      font-size:13px;
    }
    .step.active{
      background: rgba(255,79,163,.10);
      border-color: rgba(255,79,163,.25);
      color: var(--ink);
    }

    label.lbl{
      display:block;
      font-weight:900;
      font-size:12.5px;
      margin: 10px 0 6px;
    }
    input, textarea, select{
      width:100%;
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 14.5px;
      background:#fff;
      outline:none;
    }
    textarea{min-height: 110px; resize: vertical}
    input:focus, textarea:focus, select:focus{
      border-color: rgba(255,79,163,.35);
      box-shadow: 0 0 0 4px rgba(255,79,163,.10);
    }
    .helper{font-size:12.5px; color:var(--muted); margin-top:6px; line-height:1.45}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width: 760px){ .row{grid-template-columns:1fr} }

    .actions{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; flex-wrap:wrap;
      margin-top: 14px;
    }

    /* Pack tiles */
    .packTiles{display:grid; gap:10px; margin-top:10px}
    .tile{
      border:1px solid var(--line);
      border-radius: 14px;
      background:#fff;
      padding:12px;
      cursor:pointer;
      transition: transform .12s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
    }
    .tile:active{transform: translateY(1px)}
    .tile.active{
      border-color: rgba(255,79,163,.35);
      background: rgba(255,79,163,.05);
    }
    .tileTop{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .pill{
      font-size:11px; font-weight:900;
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(255,79,163,.18);
      background: rgba(255,79,163,.06);
      color: var(--ink);
      white-space:nowrap;
    }
    .pillDeal{
      border-color: rgba(255,176,32,.28);
      background: rgba(255,176,32,.10);
    }
    .tile p{margin:8px 0 0; color:var(--muted); font-size:12.8px; line-height:1.45}

    /* Quantity / Deal */
    .qtyRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px}
    .qtyBtn{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line);
      border-radius:999px;
      padding:10px 12px;
      background:#fff;
      cursor:pointer;
      font-weight:900;
      font-size:13px;
      transition: transform .12s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
      user-select:none;
    }
    .qtyBtn.active{
      border-color: rgba(255,79,163,.35);
      background: rgba(255,79,163,.05);
    }
    .qtyBtn:active{transform: translateY(1px)}
    .dealBadge{
      display:none;
      border:1px solid rgba(255,176,32,.28);
      background: rgba(255,176,32,.10);
      color: var(--ink);
      border-radius:999px;
      padding:10px 12px;
      font-weight:900;
      font-size:12.5px;
    }
    .dealBadge.show{display:inline-flex}

    /* Price breakdown */
    .priceBox{
      border-top:1px solid var(--line);
      padding-top: 12px;
      margin-top: 12px;
    }
    .priceGrid{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:8px 12px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
    }
    .priceGrid b{color:var(--ink)}
    .priceTotal{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 12px;
      border:1px solid rgba(255,79,163,.22);
      background: rgba(255,79,163,.06);
      border-radius: 14px;
      font-weight:900;
    }

    /* Konfigurator */
    .configRow{display:flex;gap:10px;flex-wrap:wrap}
    .pick{
      display:inline-flex;gap:8px;align-items:center;
      border:1px solid var(--line);
      border-radius:999px;
      padding:10px 12px;
      background:#fff;
      font-size:13px;
      user-select:none;
      cursor:pointer;
      transition: transform .12s var(--ease), background .12s var(--ease);
    }
    .pick:active{transform: translateY(1px)}
    .pick input{accent-color: var(--pink)}
    .cookiePreview{
      width:100%;
      min-height: 240px;
      display:grid;
      place-items:center;
      border:1px dashed rgba(11,27,42,.18);
      border-radius: 14px;
      background: rgba(255,79,163,.03);
      overflow:hidden;
      position:relative;
    }
    .previewHint{
      position:absolute; left:12px; bottom:12px;
      font-size:12px;
      color: rgba(11,27,42,.55);
      background: rgba(255,255,255,.80);
      border:1px solid rgba(11,27,42,.10);
      border-radius:999px;
      padding:8px 10px;
      backdrop-filter: blur(10px);
    }
    .miniBtns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}

    /* Tabs */
    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .tab{
      border:1px solid var(--line);
      border-radius:999px;
      padding:10px 12px;
      cursor:pointer;
      background:#fff;
      font-weight:900;
      font-size:13px;
      transition: transform .12s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
    }
    .tab.active{
      border-color: rgba(255,79,163,.35);
      background: rgba(255,79,163,.05);
    }
    .tab:active{transform: translateY(1px)}

    /* Recipients list */
    .recCard{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px;
      background:#fff;
      margin-top:10px;
    }
    .recHead{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom:8px;
    }
    .recTag{
      display:inline-flex; align-items:center; gap:8px;
      font-size:12px;
      font-weight:900;
      border:1px solid rgba(11,27,42,.10);
      border-radius:999px;
      padding:8px 10px;
      background: rgba(0,0,0,.02);
      color: var(--muted);
    }
    .btnDanger{
      border-color: rgba(255,79,163,.18);
      background: rgba(255,79,163,.06);
      color: var(--ink);
    }

    /* Stamp card */
    .stampWrap{
      border:1px solid rgba(39,214,164,.22);
      background: rgba(39,214,164,.08);
      border-radius: 14px;
      padding:12px;
      margin-top:12px;
    }
    .stampTop{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .stampGrid{
      display:grid;
      grid-template-columns: repeat(10, 1fr);
      gap:8px;
      margin-top:10px;
    }
    .stamp{
      height:26px;
      border-radius: 10px;
      border:1px solid rgba(11,27,42,.10);
      background: rgba(255,255,255,.75);
      display:grid;
      place-items:center;
      font-size:14px;
      user-select:none;
    }
    .stamp.on{
      background: rgba(39,214,164,.20);
      border-color: rgba(39,214,164,.28);
    }
    .rewardBadge{
      display:none;
      border:1px solid rgba(39,214,164,.28);
      background: rgba(39,214,164,.14);
      border-radius:999px;
      padding:9px 10px;
      font-weight:900;
      font-size:12.5px;
    }
    .rewardBadge.show{display:inline-flex}

    /* FAQ */
    details{
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      background:#fff;
    }
    details + details{margin-top:10px}
    summary{cursor:pointer; font-weight:900}
    details p{margin:10px 0 0; color:var(--muted); line-height:1.55; font-size:13.5px}

    /* Footer */
    footer{
      border-top:1px solid var(--line);
      padding: 18px 0 26px;
      margin-top: 16px;
      background:#fff;
    }
    .footGrid{display:grid; grid-template-columns: 1.2fr .8fr; gap:14px}
    @media (max-width: 920px){ .footGrid{grid-template-columns:1fr} }
    .footLinks{display:flex; gap:10px; flex-wrap:wrap}
    .footLinks a{
      text-decoration:none;
      font-size:13px;
      color:var(--muted);
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
      transition: background .12s var(--ease), transform .12s var(--ease);
    }
    .footLinks a:hover{background: rgba(0,0,0,.02); color:var(--ink)}
    .footLinks a:active{transform: translateY(1px)}

    /* Consent */
    .consent{
      position:fixed; left:14px; right:14px; bottom:14px;
      z-index:90; display:none;
    }
    .consent.show{display:block}
    .consentCard{
      max-width: 980px; margin:0 auto;
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.95);
      box-shadow: var(--shadow);
      padding: 12px;
      display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
      backdrop-filter: blur(12px);
    }
    .consentCard b{display:block; margin-bottom:4px}
    .consentCard p{margin:0; color:var(--muted); font-size:13px; line-height:1.45}

    /* Overlay (rewards/reveal) */
    .overlay{
      position:fixed; inset:0;
      background: rgba(11,27,42,.55);
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .overlay.show{display:flex}
    .card{
      width:min(560px, 100%);
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      box-shadow: 0 18px 60px rgba(11,27,42,.22);
      overflow:hidden;
    }
    .cardTop{
      padding:16px 16px 12px;
      background: linear-gradient(180deg, rgba(255,79,163,.12), rgba(255,79,163,.03));
      border-bottom:1px solid var(--line);
    }
    .cardBody{ padding:14px 16px 16px; }
    .cardActions{
      display:flex; gap:10px; justify-content:flex-end;
      padding:12px 16px 16px;
    }

    /* Cookie Rain */
    .cookieDrop{
      position:fixed;
      top:-40px;
      font-size:18px;
      opacity:.22;
      pointer-events:none;
      z-index:1;
      animation: drop linear forwards;
      filter: drop-shadow(0 10px 14px rgba(11,27,42,.12));
    }
    @keyframes drop{
      to{ transform: translateY(calc(100vh + 60px)) rotate(120deg); }
    }
    @media (prefers-reduced-motion: reduce){
      .cookieDrop{display:none}
    }
  </style>
</head>

<body>
  <!-- INTRO OVERLAY -->
  <div id="intro" class="intro" aria-hidden="false">
    <video id="introVid" class="introVid" autoplay muted playsinline preload="auto" poster="assets/img/1000149739.jpg">
      <source src="assets/video/intro.mp4" type="video/mp4">
    </video>
    <div class="introTop" aria-hidden="true"></div>
    <button id="skipIntro" class="introSkip" type="button">Skip</button>
    <button id="playIntro" class="introPlay" type="button" aria-label="Intro abspielen">
      ‚ñ∂Ô∏é Intro starten
    </button>
  </div>

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="wrap">
      <div class="inner">
        <a class="brand" href="#top" aria-label="OnlyKeks Start">
          <svg class="mark" viewBox="0 0 64 64" role="img" aria-label="OnlyKeks Cookie Logo">
            <defs>
              <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#ff4fa3"/>
                <stop offset="1" stop-color="#ff7cc5"/>
              </linearGradient>
            </defs>
            <path d="M32 8c-9.4 0-17.6 5.6-21 13.7-2 4.7-2 10 0 14.7C14.4 44.4 22.6 50 32 50c11 0 20.4-7.7 22.6-18.1.8-3.7.4-7.5-1.2-10.9C49.6 13 41.4 8 32 8Z" fill="#f4c9a2" stroke="rgba(11,27,42,.12)" stroke-width="1.2"/>
            <circle cx="49" cy="18" r="7.2" fill="rgba(255,255,255,.96)"/>
            <circle cx="53.8" cy="22.6" r="5.3" fill="rgba(255,255,255,.96)"/>
            <circle cx="24" cy="24" r="2.4" fill="url(#g1)"/>
            <circle cx="37" cy="26.5" r="2.2" fill="rgba(11,27,42,.28)"/>
            <circle cx="28.5" cy="36" r="2.1" fill="rgba(255,79,163,.65)"/>
            <circle cx="40.5" cy="37.5" r="2.6" fill="rgba(11,27,42,.22)"/>
          </svg>
          <div>
            <strong>OnlyKeks</strong>
            <span>Post, die schmeckt</span>
          </div>
        </a>

        <nav aria-label="Navigation">
          <a href="#how">So l√§uft‚Äôs</a>
          <a href="#flow">Konfigurator</a>
          <a href="#faq">FAQ</a>
        </nav>

        <a class="btn btnPrimary" href="#flow">Jetzt starten ‚Üí</a>
      </div>
    </div>
  </header>

  <main id="top">
    <!-- HERO -->
    <section class="hero">
      <div class="wrap">
        <div class="heroGrid">
          <div class="panel">
            <div class="kicker">Kein Account ¬∑ QR-Antwort ¬∑ echtes Post-Feeling</div>

            <h1>Gestalte deinen Keks ‚Äì und hol dir ‚Äônen Antwort-Keks zur√ºck.</h1>
            <p class="sub">
              Du schickst einen <b>QR-Antwort-Keks</b> mit Message + QR-Code. Empf√§nger*in scannt, antwortet ‚Äì wir backen den <b>Antwort-Keks</b> und schicken ihn zu dir zur√ºck.
            </p>

            <div class="trustBar" aria-label="Trust">
              <span class="trustItem"><span class="dot"></span> Versand & Tracking (MVP-Logik)</span>
              <span class="trustItem">üîí Zahlung √ºber Stripe</span>
              <span class="trustItem">üç™ Keine Datenverk√§ufe</span>
            </div>

            <div class="chips" aria-label="Vorlagen">
              <button class="chip" type="button" data-msg="Ich denk an dich. üç™">Ich denk an dich</button>
              <button class="chip" type="button" data-msg="Beweg dein Arsch ‚Äì du packst das! ‚ú®">Motivation</button>
              <button class="chip" type="button" data-msg="Happy Birthday! üéâ">Geburtstag</button>
              <button class="chip" type="button" data-msg="Vermiss dich. üíó">Vermissen</button>
              <button class="chip" type="button" data-msg="Heute Energy-Mode: Kopf hoch, Brust raus. ‚ö°Ô∏è">Energy</button>
            </div>

            <div class="heroActions">
              <a class="btn btnPrimary" href="#flow">Keks gestalten ‚Üí</a>
              <a class="btn btnGhost" href="#how">Erst kurz checken</a>
            </div>

            <hr class="hr" />

            <div class="muted" style="font-size:13.5px; line-height:1.45;">
              <b style="color:var(--ink)">Loop:</b> Scan ‚Üí Antwort in Sekunden. Wir machen den Rest (Post-Magic).
            </div>
          </div>

          <aside class="media" aria-label="Hero Media">
            <span class="badge">Geschenk-Mood ¬∑ Echt</span>

            <video id="heroVideo" autoplay muted playsinline loop preload="metadata" poster="assets/img/1000149739.jpg" style="display:none">
              <source src="assets/img/grok_video_2025-12-13-20-49-35.mp4" type="video/mp4"/>
            </video>
            <img id="heroImg" src="assets/img/1000149739.jpg" alt="Jemand h√§lt einen Keks, scannt den QR-Code und l√§chelt" loading="eager" decoding="async"/>
          </aside>
        </div>
      </div>
    </section>

    <!-- HOW -->
    <section class="section" id="how">
      <div class="wrap">
        <div class="grid2">
          <div class="panel">
            <h2>So l√§uft‚Äôs</h2>
            <ul>
              <li><b>Du schreibst</b> eine Message, w√§hlst Paket & Anzahl.</li>
              <li><b>Du gestaltest</b> den Keks (Form, Deko, Style).</li>
              <li><b>Wir verschicken</b> Keks + QR-Karte.</li>
              <li><b>Scan ‚Üí Antwort</b> (ohne Konto). Danach kommt dein <b>Antwort-Keks</b>.</li>
            </ul>
          </div>
          <div class="panel">
            <h2>Warum das zieht</h2>
            <ul>
              <li>Wie Social ‚Äì aber als echtes Geschenk im Briefkasten.</li>
              <li><b>Konfigurator-Spieltrieb</b>: ‚ÄúNoch eins‚Ä¶ nur kurz testen‚Ä¶‚Äù</li>
              <li><b>Viral</b>: Share-Link + Einladungen + Belohnungen.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- FLOW -->
    <section class="section" id="flow">
      <div class="wrap">
        <div class="panel">
          <div class="flowHead">
            <h2 style="margin:0">Konfigurator-Flow</h2>
            <div class="steps" aria-label="Schritte">
              <div class="step active" data-step="1">1</div>
              <div class="step" data-step="2">2</div>
              <div class="step" data-step="3">3</div>
              <div class="step" data-step="4">4</div>
              <div class="step" data-step="5">5</div>
            </div>
          </div>

          <!-- Step 1 -->
          <div class="flowPanel" id="p1">
            <label class="lbl" for="msg">Deine Message</label>
            <textarea id="msg" maxlength="500" placeholder="Schreib was S√º√ües‚Ä¶ (max. 500 Zeichen)"></textarea>
            <div class="helper" id="count">0 / 500</div>

            <div class="row">
              <div>
                <label class="lbl" for="pack">Paket</label>
                <select id="pack" name="pack">
                  <option value="Quick">Quick</option>
                  <option value="Custom" selected>Custom</option>
                  <option value="Premium">Premium</option>
                </select>

                <div class="packTiles" id="packTiles" role="radiogroup" aria-label="Paket w√§hlen">
                  <div class="tile" role="radio" aria-checked="false" data-pack="Quick">
                    <div class="tileTop"><b>Quick</b><span class="pill">simpel & sweet</span></div>
                    <p>Fixer Keks, klare Message, sauber verpackt.</p>
                  </div>
                  <div class="tile" role="radio" aria-checked="true" data-pack="Custom">
                    <div class="tileTop"><b>Custom</b><span class="pill">mehr Deko</span></div>
                    <p>Beliebt: Deko-Finish + nicerer Auftritt.</p>
                  </div>
                  <div class="tile" role="radio" aria-checked="false" data-pack="Premium">
                    <div class="tileTop"><b>Premium</b><span class="pill">Box-Vibe</span></div>
                    <p>Edle Box, maximaler Geschenk-Moment.</p>
                  </div>
                </div>
              </div>

              <div>
                <label class="lbl">Anzahl</label>
                <div class="qtyRow" role="radiogroup" aria-label="Anzahl w√§hlen">
                  <div class="qtyBtn active" data-qty="1" role="radio" aria-checked="true">1 Keks</div>
                  <div class="qtyBtn" data-qty="3" role="radio" aria-checked="false">3er Pack</div>
                  <div class="qtyBtn" data-qty="5" role="radio" aria-checked="false">5er Pack</div>
                  <span class="dealBadge" id="dealBadge">üî• 3er-Deal: ‚àí25%</span>
                </div>

                <div class="priceBox">
                  <div class="priceGrid" aria-label="Preis√ºbersicht">
                    <div><b id="priceTitle">Custom</b> <span class="muted" id="priceNote">Beliebt ¬∑ Deko-Finish</span></div>
                    <div style="text-align:right" id="unitPrice">14,90 ‚Ç¨ / St√ºck</div>

                    <div>Zwischensumme</div>
                    <div style="text-align:right" id="subtotal">14,90 ‚Ç¨</div>

                    <div>Rabatt</div>
                    <div style="text-align:right" id="discount">‚Äî</div>
                  </div>

                  <div class="priceTotal">
                    <span>Gesamt</span>
                    <span id="total">14,90 ‚Ç¨</span>
                  </div>

                  <div class="helper" style="margin-top:8px">
                    <b>Multi-Empf√§nger:</b> Bei Pack > 1 kannst du an mehrere Personen schicken ‚Äì jede Person kriegt ihren eigenen Keks.
                  </div>
                </div>
              </div>
            </div>

            <div class="actions">
              <span class="muted" style="font-size:13px">Schritt 1/5</span>
              <button class="btn btnPrimary" type="button" id="next1">Weiter ‚Üí</button>
            </div>
          </div>

          <!-- Step 2 (Konfigurator) -->
          <div class="flowPanel" id="p2" style="display:none">
            <h2 style="font-size:16px;margin:0 0 6px;">Keks gestalten</h2>
            <p class="muted" style="margin:0 0 10px;font-size:13.5px">
              W√§hl Form, Deko und Theme. Dit ist dein Spielplatz.
            </p>

            <div class="row">
              <div class="tile" style="cursor:default">
                <b>Theme (Preset)</b>
                <div class="tabs" id="themeTabs" aria-label="Themes">
                  <button class="tab active" type="button" data-theme="sweet">S√º√ü</button>
                  <button class="tab" type="button" data-theme="frech">Frech</button>
                  <button class="tab" type="button" data-theme="energy">Energy ‚ö°Ô∏è</button>
                </div>

                <div style="margin-top:12px">
                  <b>Form</b>
                  <div class="configRow" style="margin-top:10px">
                    <label class="pick"><input type="radio" name="shape" value="round" checked> Rund</label>
                    <label class="pick"><input type="radio" name="shape" value="heart"> Herz</label>
                    <label class="pick"><input type="radio" name="shape" value="mouse"> Maus-Keks üê≠üç™</label>
                  </div>
                </div>

                <div style="margin-top:12px">
                  <b>Deko</b>
                  <div class="configRow" style="margin-top:10px">
                    <label class="pick"><input type="checkbox" id="dSprinkles"> Sprinkles</label>
                    <label class="pick"><input type="checkbox" id="dSmiley"> Smiley</label>
                    <label class="pick"><input type="checkbox" id="dKiss"> Kuss-Stempel</label>
                    <label class="pick"><input type="checkbox" id="dBolt"> Blitz ‚ö°Ô∏è</label>
                  </div>
                </div>

                <div style="margin-top:12px">
                  <b>Farbe</b>
                  <div style="display:flex;gap:10px;align-items:center;margin-top:10px">
                    <input type="color" id="dIcing" value="#ff4fa3" style="width:54px;height:40px;padding:0;border-radius:12px">
                    <span class="muted" style="font-size:13px">Icing-Akzent</span>
                  </div>
                </div>

                <div class="miniBtns">
                  <button class="btn btnGhost" type="button" id="undoBtn">‚Ü∂ Undo</button>
                  <button class="btn btnGhost" type="button" id="redoBtn">‚Ü∑ Redo</button>
                  <button class="btn btnGhost" type="button" id="surpriseBtn">√úberrasch mich üç™</button>
                </div>

                <p class="muted" style="margin:10px 0 0;font-size:12.8px;line-height:1.45">
                  MVP-Preview (Vorschau-Simulation). Sp√§ter: echte Sticker, Teilen, Drops.
                </p>
              </div>

              <div class="tile" style="cursor:default">
                <b>Vorschau</b>
                <div id="cookiePreview" class="cookiePreview" style="margin-top:10px">
                  <span class="previewHint">Live-Vorschau</span>
                </div>

                <div class="tile" style="margin-top:12px; cursor:default">
                  <b>Teilen (Viral)</b>
                  <p class="muted" style="margin:6px 0 10px;font-size:13px;line-height:1.45">
                    Schick deinen Konfigurator-Entwurf als Link. Wer √ºber deinen Link startet, z√§hlt als Einladung.
                  </p>
                  <div style="display:flex;gap:10px;flex-wrap:wrap">
                    <button class="btn btnGhost" type="button" id="copyShare">Link kopieren</button>
                    <button class="btn btnPrimary" type="button" id="nativeShare">Teilen ‚Üí</button>
                  </div>
                  <div class="helper" id="shareHint" style="margin-top:8px">‚Äî</div>
                </div>

              </div>
            </div>

            <div class="actions">
              <button class="btn btnGhost" type="button" id="back2">‚Üê Zur√ºck</button>
              <button class="btn btnPrimary" type="button" id="next2">Weiter ‚Üí</button>
            </div>
          </div>

          <!-- Step 3 (Multi-Empf√§nger) -->
          <div class="flowPanel" id="p3" style="display:none">
            <h2 style="font-size:16px;margin:0 0 6px;">Adressen</h2>
            <p class="muted" style="margin:0 0 10px;font-size:13.5px">
              Empf√§nger*in(nen) + deine Adresse (f√ºr den Antwort-Keks). Bei Packs > 1: mehrere Empf√§nger m√∂glich.
            </p>

            <div class="row">
              <div>
                <label class="lbl" for="fromName">Dein Name</label>
                <input id="fromName" placeholder="z. B. Schmidti" />
              </div>
              <div>
                <label class="lbl" for="fromStreet">Deine Stra√üe & Hausnummer</label>
                <input id="fromStreet" placeholder="Deine Stra√üe 3" />
              </div>
            </div>

            <div class="row">
              <div>
                <label class="lbl" for="fromZip">Deine PLZ</label>
                <input id="fromZip" inputmode="numeric" placeholder="12345" />
              </div>
              <div>
                <label class="lbl" for="fromCity">Dein Ort</label>
                <input id="fromCity" placeholder="Berlin" />
              </div>
            </div>

            <hr class="hr"/>

            <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center">
              <b>Empf√§nger</b>
              <div style="display:flex; gap:10px; flex-wrap:wrap">
                <span class="recTag" id="recCountTag">0 / 1</span>
                <button class="btn btnGhost" type="button" id="addRecipient">+ Empf√§nger hinzuf√ºgen</button>
              </div>
            </div>

            <div id="recipients"></div>

            <div class="actions">
              <button class="btn btnGhost" type="button" id="back3">‚Üê Zur√ºck</button>
              <button class="btn btnPrimary" type="button" id="next3">Weiter ‚Üí</button>
            </div>
          </div>

          <!-- Step 4 -->
          <div class="flowPanel" id="p4" style="display:none">
            <h2 style="font-size:16px;margin:0 0 6px;">Check</h2>
            <div class="muted" id="summary" style="font-size:13.5px; line-height:1.55;"></div>

            <div class="actions">
              <button class="btn btnGhost" type="button" id="back4">‚Üê Zur√ºck</button>
              <button class="btn btnPrimary" type="button" id="next4">Weiter zum Bezahlen ‚Üí</button>
            </div>
          </div>

          <!-- Step 5 -->
          <div class="flowPanel" id="p5" style="display:none">
            <h2 style="font-size:16px;margin:0 0 6px;">Bezahlen</h2>
            <p class="muted" style="margin:0 0 10px;font-size:13.5px">Weiterleitung √ºber Stripe (MVP-Link).</p>

            <div class="tile" style="cursor:default">
              <div class="muted" style="font-size:13.5px; line-height:1.55">
                <b style="color:var(--ink)">OrderID:</b> <span id="oid">(wird erstellt)</span><br/>
                <b style="color:var(--ink)">Paket:</b> <span id="sPack">Custom</span><br/>
                <b style="color:var(--ink)">Anzahl:</b> <span id="sQty">1</span><br/>
                <b style="color:var(--ink)">Gesamt:</b> <span id="sTotal">‚Äî</span><br/>
                <b style="color:var(--ink)">Message:</b> <span id="sMsg">(deine Message)</span><br/>
                <b style="color:var(--ink)">Design:</b> <span id="sDesign">‚Äî</span><br/>
                <b style="color:var(--ink)">Empf√§nger:</b> <span id="sRecs">‚Äî</span>
              </div>
            </div>

            <div class="stampWrap">
              <div class="stampTop">
                <b>üç™ Stempelkarte</b>
                <span class="rewardBadge" id="rewardBadge">üéÅ Belohnung ready</span>
              </div>
              <div class="muted" style="font-size:13px; margin-top:6px; line-height:1.45">
                Pro gekauftem Keks 1 Stempel. Ab 10: Belohnung (Gratis-Keks oder Rabatt).
              </div>
              <div class="stampGrid" id="stampGrid" aria-label="Stempelkarte"></div>
              <div class="helper" id="stampHint" style="margin-top:10px">‚Äî</div>
            </div>

            <div class="actions">
              <button class="btn btnGhost" type="button" id="back5">‚Üê Zur√ºck</button>
              <a class="btn btnPrimary" id="payBtn" href="#" rel="noopener">Jetzt mit Stripe bezahlen ‚Üí</a>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="section" id="faq">
      <div class="wrap">
        <div class="panel">
          <h2>FAQ</h2>
          <details>
            <summary>Wie antwortet die Empf√§nger*in?</summary>
            <p>√úber den QR-Code auf der Karte. Kein Konto, keine App. Scan ‚Üí Text tippen ‚Üí absenden.</p>
          </details>
          <details>
            <summary>Was passiert nach der Antwort?</summary>
            <p>Wir backen den <b>Antwort-Keks</b> mit der Antwort-Message und schicken ihn an deine Adresse zur√ºck.</p>
          </details>
          <details>
            <summary>Welche Daten speichert ihr?</summary>
            <p>Im MVP speichern wir deinen Entwurf lokal im Browser. Optionales Tracking ist standardm√§√üig aus.</p>
          </details>
          <details>
            <summary>Mehrere Empf√§nger ‚Äì wie funktioniert das?</summary>
            <p>Du w√§hlst z. B. ein 3er-Pack und legst bis zu 3 Empf√§nger-Adressen an. Jeder Empf√§nger bekommt seinen eigenen Keks. (MVP-Light: Message & Design gelten f√ºr alle.)</p>
          </details>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <div class="footGrid">
        <div>
          <div style="display:flex;align-items:center;gap:10px;">
            <b>OnlyKeks</b>
            <span class="muted" style="font-size:13px">Post, die schmeckt</span>
          </div>
          <p class="muted" style="margin:10px 0 0; font-size:13px; line-height:1.45">
            MVP: One-Page + Konfigurator-Flow + QR-Antwort-Loop. Clean, schnell, vertrauensw√ºrdig.
          </p>
        </div>
        <div class="footLinks" aria-label="Footer Links">
          <a href="#faq">FAQ</a>
          <a href="privacy.html">Wie wir mit Daten umgehen</a>
          <a href="keks.html">QR-Antwort Demo</a>
          <a href="#top">Nach oben</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- COOKIE CONSENT -->
  <div class="consent" id="consent">
    <div class="consentCard" role="dialog" aria-label="Cookie Hinweis" aria-modal="true">
      <div>
        <b>Cookie-Kr√ºmel üç™</b>
        <p>Notwendig: Entwurf speichern. Optional: verstehen, welche Kekse gefallen. Wir verkaufen keine Daten.</p>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end">
        <button class="btn btnPrimary btnSmall" type="button" id="consentAll">Alles klar üç™</button>
        <button class="btn btnGhost btnSmall" type="button" id="consentNeed">Nur das N√∂tigste</button>
        <a class="btn btnGhost btnSmall" href="privacy.html">Details</a>
      </div>
    </div>
  </div>

  <!-- Reward Overlay -->
  <div class="overlay" id="rewardOverlay" aria-hidden="true">
    <div class="card" role="dialog" aria-modal="true" aria-label="Belohnung">
      <div class="cardTop">
        <h3 style="margin:0;font-size:16px">üéÅ Belohnung freigeschaltet</h3>
        <div class="muted" style="margin-top:6px;font-size:12.5px" id="rewardSub">‚Äî</div>
      </div>
      <div class="cardBody">
        <p class="muted" style="margin:0;line-height:1.55">
          Du hast 10 Stempel voll. Dit ist der Moment, wo Leute screenshots machen ‚Äì und zack: Viral.
        </p>
        <div class="tile" style="margin-top:12px; cursor:default">
          <b>Deine Optionen (MVP-Copy)</b>
          <p class="muted" style="margin:6px 0 0;line-height:1.55">
            ‚Ä¢ <b>Gratis-Keks</b> beim n√§chsten Kauf<br/>
            ‚Ä¢ oder <b>Rabatt</b> auf Premium-Box
          </p>
        </div>
      </div>
      <div class="cardActions">
        <button class="btn btnGhost" type="button" id="rewardClose">Sp√§ter</button>
        <button class="btn btnPrimary" type="button" id="rewardShare">Teilen ‚Üí</button>
      </div>
    </div>
  </div>

  <script>
    /*** CONFIG: STRIPE ***/
    const STRIPE_PAYMENT_LINK = "https://buy.stripe.com/aBcDeFgHiJkLmNoPqR";

    const $ = (id)=>document.getElementById(id);
    const qsa = (sel,root=document)=>Array.from(root.querySelectorAll(sel));

    window.addEventListener("error", (e)=>console.warn("OnlyKeks JS error:", e.message));
    window.addEventListener("unhandledrejection", (e)=>console.warn("OnlyKeks promise error:", e.reason));

    /* Utils */
    const money = (n)=> new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(n);
    function esc(str){
      return String(str ?? "")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    /* State */
    const LS_KEY = "onlykeks_state_master_v1";
    function readState(){ try{return JSON.parse(localStorage.getItem(LS_KEY)||"{}");}catch(e){return{};} }
    function writeState(patch){
      const cur = readState();
      const next = Object.assign({}, cur, patch);
      localStorage.setItem(LS_KEY, JSON.stringify(next));
      return next;
    }
    function uid(){
      const a = Math.random().toString(36).slice(2,8).toUpperCase();
      const b = Date.now().toString(36).slice(-6).toUpperCase();
      return `OK-${b}-${a}`;
    }

    /* Intro Gate (Fullscreen Video before app) */
    (function introGate(){
      const KEY = "onlykeks_intro_seen_v2";
      const intro = $("intro");
      const vid   = $("introVid");
      const skip  = $("skipIntro");
      const play  = $("playIntro");

      const showApp = ()=>{
        document.documentElement.classList.add("appReady");
        if(intro) intro.classList.add("hide");
        setTimeout(()=> intro && intro.remove(), 260);
      };

      if(localStorage.getItem(KEY)){
        if(intro) intro.remove();
        document.documentElement.classList.add("appReady");
        return;
      }

      const done = ()=>{
        localStorage.setItem(KEY, "1");
        showApp();
      };

      // failsafe: wenn Video nicht will ‚Üí App zeigen
      const failsafe = setTimeout(done, 3600);

      skip?.addEventListener("click", ()=>{ clearTimeout(failsafe); done(); });

      vid?.addEventListener("ended", ()=>{ clearTimeout(failsafe); done(); });
      vid?.addEventListener("error", ()=>{ clearTimeout(failsafe); done(); });

      // Autoplay attempt; wenn blocked ‚Üí Play Button zeigen
      const tryPlay = ()=>{
        const p = vid?.play?.();
        if(p && typeof p.catch === "function"){
          p.catch(()=>{
            play?.classList.add("show");
          });
        }
      };

      play?.addEventListener("click", ()=>{
        play.classList.remove("show");
        tryPlay();
        // wenn nach Click trotzdem nix ‚Üí nach kurzer Zeit App zeigen
        setTimeout(()=>{ /* keep intro a moment */ }, 350);
      });

      tryPlay();
    })();

    /* Hero media fallback */
    (function heroMedia(){
      const v = $("heroVideo");
      const img = $("heroImg");
      if(!v || !img) return;
      const showVideo = ()=>{ img.style.display="none"; v.style.display="block"; };
      const showImg   = ()=>{ v.style.display="none"; img.style.display="block"; };
      showImg();
      v.addEventListener("canplay", showVideo, {once:true});
      v.addEventListener("error", showImg, {once:true});
      const p = v.play();
      if(p && typeof p.catch === "function") p.catch(()=>showImg());
    })();

    /* Pricing */
    const BASE = { Quick: 9.90, Custom: 14.90, Premium: 19.90 };
    const DEALS = {
      3: { pct: 0.25, label: "3er-Deal ‚àí25%" },
      5: { pct: 0.30, label: "5er-Deal ‚àí30%" }
    };

    function pricing(pack, qty){
      const unit = BASE[pack] ?? BASE.Custom;
      const sub = unit * qty;
      const deal = DEALS[qty] || null;
      const disc = deal ? (sub * deal.pct) : 0;
      const total = Math.max(0, sub - disc);
      return { unit, sub, disc, total, deal };
    }

    function packMeta(pack){
      if(pack==="Quick")   return {title:"Quick",   note:"Schnell & sweet"};
      if(pack==="Premium") return {title:"Premium", note:"Box-Vibe"};
      return {title:"Custom", note:"Beliebt ¬∑ Deko-Finish"};
    }

    /* Flow panels */
    const panels = {1:$("p1"),2:$("p2"),3:$("p3"),4:$("p4"),5:$("p5")};
    const steps = qsa(".step");
    function go(n){
      Object.entries(panels).forEach(([k,p])=>{ if(p) p.style.display = (+k===n) ? "block":"none"; });
      steps.forEach(s=>s.classList.toggle("active", +s.dataset.step===n));
      document.querySelector("#flow").scrollIntoView({behavior:"smooth", block:"start"});
      if(n===5) syncPayPanel();
    }

    /* Message + chips */
    const msg = $("msg");
    const count = $("count");
    function updateCount(){
      if(!msg || !count) return;
      count.textContent = `${msg.value.length} / 500`;
      writeState({msg: msg.value});
    }
    msg?.addEventListener("input", updateCount);

    qsa(".chip").forEach(ch=>{
      ch.addEventListener("click", ()=>{
        if(!msg) return;
        msg.value = ch.dataset.msg || "";
        updateCount();
        document.querySelector("#flow").scrollIntoView({behavior:"smooth", block:"start"});
      });
    });

    /* Pack tiles */
    const packSel = $("pack");
    const packTiles = qsa(".tile", $("packTiles") || document);
    function setPack(pack){
      packSel && (packSel.value = pack);
      packTiles.forEach(t=>{
        const on = (t.dataset.pack === pack);
        t.classList.toggle("active", on);
        t.setAttribute("aria-checked", on ? "true":"false");
      });
      writeState({pack});
      refreshPriceUI();
    }
    packTiles.forEach(t=>t.addEventListener("click", ()=>setPack(t.dataset.pack)));
    packSel?.addEventListener("change", ()=>setPack(packSel.value));

    /* Qty */
    const qtyBtns = qsa(".qtyBtn");
    function setQty(qty){
      qty = Number(qty || 1);
      qtyBtns.forEach(b=>{
        const on = Number(b.dataset.qty) === qty;
        b.classList.toggle("active", on);
        b.setAttribute("aria-checked", on ? "true":"false");
      });
      writeState({qty});
      refreshPriceUI();
      ensureRecipientsForQty();
    }
    qtyBtns.forEach(b=>b.addEventListener("click", ()=>setQty(b.dataset.qty)));

    function refreshPriceUI(){
      const s = readState();
      const pack = s.pack || "Custom";
      const qty = Number(s.qty || 1);
      const pm = packMeta(pack);
      const p = pricing(pack, qty);

      $("priceTitle") && ($("priceTitle").textContent = pm.title);
      $("priceNote")  && ($("priceNote").textContent  = pm.note);
      $("unitPrice")  && ($("unitPrice").textContent  = `${money(p.unit)} / St√ºck`);
      $("subtotal")   && ($("subtotal").textContent   = money(p.sub));
      $("discount")   && ($("discount").textContent   = p.deal ? `‚àí${money(p.disc)} (${p.deal.label})` : "‚Äî");
      $("total")      && ($("total").textContent      = money(p.total));

      const dealBadge = $("dealBadge");
      if(dealBadge){
        dealBadge.classList.toggle("show", !!p.deal);
        dealBadge.textContent = p.deal ? `üî• ${p.deal.label}` : "";
      }
    }

    /* =========================
       KONFIGURATOR (Design + History)
    ========================= */
    const HISTORY_MAX = 30;

    function getDesign(){
      const s = readState();
      return s.design || { theme:"sweet", shape:"round", sprinkles:false, smiley:false, kiss:false, bolt:false, icing:"#ff4fa3" };
    }
    function pushHistory(nextDesign){
      const s = readState();
      const hist = Array.isArray(s.hist) ? s.hist : [];
      const idx = typeof s.histIdx === "number" ? s.histIdx : (hist.length - 1);

      const pruned = hist.slice(0, idx + 1);
      pruned.push(nextDesign);
      const clipped = pruned.slice(-HISTORY_MAX);
      const newIdx = clipped.length - 1;

      writeState({ hist: clipped, histIdx: newIdx, design: nextDesign });
    }
    function setDesign(patch, {skipHist=false} = {}){
      const cur = getDesign();
      const next = Object.assign({}, cur, patch);
      if(skipHist){
        writeState({design: next});
      }else{
        pushHistory(next);
      }
      syncConfiguratorUI();
      renderPreview();
      updateShareHint();
    }

    function svgCookie(d){
      const icing = d.icing || "#ff4fa3";
      const bolt = d.bolt ? `
        <path d="M170 85 L145 135 L170 135 L150 185 L200 120 L175 120 Z"
          fill="rgba(255,176,32,.95)" stroke="rgba(11,27,42,.10)" stroke-width="2" />
      ` : "";

      const spr = d.sprinkles ? `
        <circle cx="95" cy="90" r="4" fill="${icing}" opacity=".85"/>
        <circle cx="150" cy="130" r="3" fill="rgba(11,27,42,.25)"/>
        <circle cx="120" cy="160" r="4" fill="${icing}" opacity=".85"/>
        <circle cx="180" cy="165" r="3" fill="rgba(11,27,42,.22)"/>
        <circle cx="210" cy="120" r="3" fill="${icing}" opacity=".75"/>
      ` : "";

      const smile = d.smiley ? `
        <circle cx="140" cy="132" r="3.5" fill="rgba(11,27,42,.45)"/>
        <circle cx="175" cy="132" r="3.5" fill="rgba(11,27,42,.45)"/>
        <path d="M145 150 Q158 164 171 150" fill="none" stroke="rgba(11,27,42,.45)" stroke-width="5" stroke-linecap="round"/>
      ` : "";

      const kiss = d.kiss ? `
        <path d="M150 115c10-8 22-8 32 0c-3 10-12 18-16 20c-4-2-13-10-16-20Z"
          fill="${icing}" opacity=".9"/>
      ` : "";

      const round = `
        <circle cx="160" cy="140" r="90" fill="#f4c9a2" stroke="rgba(11,27,42,.12)" stroke-width="2"/>
      `;
      const heart = `
        <path d="M160 220
          C90 170, 90 120, 125 105
          C145 96, 158 108, 160 118
          C162 108, 175 96, 195 105
          C230 120, 230 170, 160 220Z"
          fill="#f4c9a2" stroke="rgba(11,27,42,.12)" stroke-width="2"/>
      `;
      const mouse = `
        <circle cx="160" cy="150" r="78" fill="#f4c9a2" stroke="rgba(11,27,42,.12)" stroke-width="2"/>
        <circle cx="105" cy="95" r="28" fill="#f4c9a2" stroke="rgba(11,27,42,.12)" stroke-width="2"/>
        <circle cx="215" cy="95" r="28" fill="#f4c9a2" stroke="rgba(11,27,42,.12)" stroke-width="2"/>
      `;

      const shapeSvg = (d.shape==="heart") ? heart : (d.shape==="mouse") ? mouse : round;

      const themeGlow = d.theme==="energy"
        ? `<defs>
            <radialGradient id="glow" cx="50%" cy="45%" r="70%">
              <stop offset="0" stop-color="rgba(255,176,32,.35)"/>
              <stop offset="1" stop-color="rgba(255,255,255,0)"/>
            </radialGradient>
          </defs>
          <circle cx="160" cy="140" r="120" fill="url(#glow)"/>`
        : d.theme==="frech"
          ? `<defs>
              <radialGradient id="glow2" cx="45%" cy="45%" r="70%">
                <stop offset="0" stop-color="rgba(255,79,163,.28)"/>
                <stop offset="1" stop-color="rgba(255,255,255,0)"/>
              </radialGradient>
            </defs>
            <circle cx="160" cy="140" r="120" fill="url(#glow2)"/>`
          : `<defs>
              <radialGradient id="glow3" cx="50%" cy="50%" r="70%">
                <stop offset="0" stop-color="rgba(255,79,163,.18)"/>
                <stop offset="1" stop-color="rgba(255,255,255,0)"/>
              </radialGradient>
            </defs>
            <circle cx="160" cy="140" r="120" fill="url(#glow3)"/>`;

      return `
      <svg viewBox="0 0 320 280" width="100%" height="220" role="img" aria-label="Keks Vorschau">
        ${themeGlow}
        ${shapeSvg}
        ${spr}
        ${bolt}
        ${kiss}
        ${smile}
        <circle cx="120" cy="120" r="5" fill="${icing}" opacity=".65"/>
        <circle cx="205" cy="175" r="5" fill="rgba(11,27,42,.20)"/>
      </svg>`;
    }

    function renderPreview(){
      const box = $("cookiePreview");
      if(!box) return;
      const d = getDesign();
      box.innerHTML = svgCookie(d) + `<span class="previewHint">Live-Vorschau</span>`;
    }

    function syncConfiguratorUI(){
      const d = getDesign();

      // tabs
      qsa(".tab", $("themeTabs") || document).forEach(t=>{
        const on = t.dataset.theme === d.theme;
        t.classList.toggle("active", on);
      });

      // shape radios
      const r = document.querySelector(`input[name="shape"][value="${d.shape}"]`);
      if(r) r.checked = true;

      $("dSprinkles") && ($("dSprinkles").checked = !!d.sprinkles);
      $("dSmiley")    && ($("dSmiley").checked = !!d.smiley);
      $("dKiss")      && ($("dKiss").checked = !!d.kiss);
      $("dBolt")      && ($("dBolt").checked = !!d.bolt);
      $("dIcing")     && ($("dIcing").value = d.icing || "#ff4fa3");

      // undo/redo availability
      const s = readState();
      const hist = Array.isArray(s.hist) ? s.hist : [];
      const idx = typeof s.histIdx === "number" ? s.histIdx : (hist.length - 1);
      $("undoBtn") && ($("undoBtn").disabled = !(idx > 0));
      $("redoBtn") && ($("redoBtn").disabled = !(idx < hist.length - 1));
    }

    function designLabel(d){
      d = d || getDesign();
      const parts = [];
      parts.push(d.shape==="heart" ? "Herz" : d.shape==="mouse" ? "Maus" : "Rund");
      if(d.sprinkles) parts.push("Sprinkles");
      if(d.smiley) parts.push("Smiley");
      if(d.kiss) parts.push("Kuss");
      if(d.bolt) parts.push("Blitz");
      parts.push(d.theme==="energy" ? "Energy" : d.theme==="frech" ? "Frech" : "S√º√ü");
      return parts.join(" ¬∑ ");
    }

    function applyTheme(theme){
      // presets (energie: bolt + amber, frech: kiss + pink2, s√º√ü: smiley+sprinkles)
      if(theme==="energy"){
        setDesign({theme:"energy", bolt:true, sprinkles:true, smiley:false, kiss:false, icing:"#ffb020"});
        return;
      }
      if(theme==="frech"){
        setDesign({theme:"frech", kiss:true, sprinkles:true, smiley:false, bolt:false, icing:"#ff7cc5"});
        return;
      }
      setDesign({theme:"sweet", smiley:true, sprinkles:true, kiss:false, bolt:false, icing:"#ff4fa3"});
    }

    function randomPreset(){
      const presets = [
        {theme:"sweet", shape:"round", sprinkles:true,  smiley:true,  kiss:false, bolt:false, icing:"#ff4fa3"},
        {theme:"frech", shape:"mouse", sprinkles:true,  smiley:false, kiss:true,  bolt:false, icing:"#ff7cc5"},
        {theme:"energy",shape:"heart", sprinkles:true,  smiley:false, kiss:false, bolt:true,  icing:"#ffb020"},
      ];
      const p = presets[Math.floor(Math.random()*presets.length)];
      setDesign(p);
    }

    function undo(){
      const s = readState();
      const hist = Array.isArray(s.hist) ? s.hist : [];
      let idx = typeof s.histIdx === "number" ? s.histIdx : (hist.length - 1);
      if(idx <= 0) return;
      idx -= 1;
      const d = hist[idx];
      writeState({histIdx: idx, design: d});
      syncConfiguratorUI();
      renderPreview();
      updateShareHint();
    }
    function redo(){
      const s = readState();
      const hist = Array.isArray(s.hist) ? s.hist : [];
      let idx = typeof s.histIdx === "number" ? s.histIdx : (hist.length - 1);
      if(idx >= hist.length - 1) return;
      idx += 1;
      const d = hist[idx];
      writeState({histIdx: idx, design: d});
      syncConfiguratorUI();
      renderPreview();
      updateShareHint();
    }

    function wireConfigurator(){
      // tabs
      qsa(".tab", $("themeTabs") || document).forEach(t=>{
        t.addEventListener("click", ()=>applyTheme(t.dataset.theme));
      });

      // shape
      document.querySelectorAll('input[name="shape"]').forEach(r=>{
        r.addEventListener("change", ()=> setDesign({shape: r.value}));
      });

      // toggles
      $("dSprinkles")?.addEventListener("change", (e)=> setDesign({sprinkles: e.target.checked}));
      $("dSmiley")?.addEventListener("change", (e)=> setDesign({smiley: e.target.checked}));
      $("dKiss")?.addEventListener("change", (e)=> setDesign({kiss: e.target.checked}));
      $("dBolt")?.addEventListener("change", (e)=> setDesign({bolt: e.target.checked}));
      $("dIcing")?.addEventListener("input", (e)=> setDesign({icing: e.target.value}));

      $("surpriseBtn")?.addEventListener("click", randomPreset);
      $("undoBtn")?.addEventListener("click", undo);
      $("redoBtn")?.addEventListener("click", redo);

      // init history if empty
      const s = readState();
      if(!Array.isArray(s.hist) || s.hist.length === 0){
        const base = getDesign();
        writeState({hist:[base], histIdx:0, design: base});
      }
      syncConfiguratorUI();
      renderPreview();
    }

    /* =========================
       Viral: Invite/Share Link
    ========================= */
    function getUID(){
      const s = readState();
      if(s.uid) return s.uid;
      const id = "u_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
      writeState({uid: id});
      return id;
    }
    function encodeStateForShare(){
      const s = readState();
      const d = getDesign();
      // keep small (no addresses!)
      const payload = {
        uid: getUID(),
        pack: s.pack || "Custom",
        qty: Number(s.qty||1),
        msg: (s.msg || "").slice(0, 240),
        design: {theme:d.theme, shape:d.shape, sprinkles:!!d.sprinkles, smiley:!!d.smiley, kiss:!!d.kiss, bolt:!!d.bolt, icing:d.icing}
      };
      const json = JSON.stringify(payload);
      // base64url
      const b64 = btoa(unescape(encodeURIComponent(json))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","");
      return b64;
    }
    function shareUrl(){
      const b64 = encodeStateForShare();
      const ref = getUID();
      const url = new URL(location.href);
      url.searchParams.set("ref", ref);
      url.searchParams.set("draft", b64);
      return url.toString();
    }
    async function copyText(t){
      try{
        await navigator.clipboard.writeText(t);
        return true;
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = t;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand("copy"); }catch(_){}
        ta.remove();
        return true;
      }
    }
    function updateShareHint(){
      const hint = $("shareHint");
      if(!hint) return;
      hint.textContent = `Dein Link ist ready. (Keine Adressen drin.)`;
    }
    $("copyShare")?.addEventListener("click", async ()=>{
      const url = shareUrl();
      await copyText(url);
      const hint = $("shareHint");
      if(hint) hint.textContent = "Link kopiert. Jetzt ab in WhatsApp/IG/TikTok-DM. üòà";
    });
    $("nativeShare")?.addEventListener("click", async ()=>{
      const url = shareUrl();
      const text = "Guck mal: Ich hab ‚Äônen Keks gestaltet. üòÑüç™";
      try{
        if(navigator.share){
          await navigator.share({title:"OnlyKeks", text, url});
        }else{
          await copyText(url);
        }
      }catch(e){}
      const hint = $("shareHint");
      if(hint) hint.textContent = "Teilen ready. Wenn‚Äôs nicht ging: Link ist kopiert.";
    });

    /* Apply draft from URL (prefill) */
    (function applyDraftFromUrl(){
      const p = new URLSearchParams(location.search);
      const draft = p.get("draft");
      const ref = p.get("ref");
      if(ref){
        const s = readState();
        if(!s.referredBy){
          writeState({referredBy: ref, referredAt: new Date().toISOString()});
        }
      }
      if(!draft) return;
      try{
        const b64 = draft.replaceAll("-","+").replaceAll("_","/");
        const pad = b64.length % 4 ? "=".repeat(4 - (b64.length % 4)) : "";
        const json = decodeURIComponent(escape(atob(b64 + pad)));
        const data = JSON.parse(json);

        if(data?.msg && msg){ msg.value = data.msg; }
        writeState({msg: msg?.value || ""});
        updateCount();

        if(data?.pack) setPack(data.pack);
        if(data?.qty) setQty(data.qty);

        if(data?.design) setDesign(data.design, {skipHist:true});
      }catch(e){}
    })();

    /* =========================
       Multi-Empf√§nger (MVP-light)
    ========================= */
    function getRecipients(){
      const s = readState();
      return Array.isArray(s.recipients) ? s.recipients : [];
    }
    function setRecipients(recipients){
      writeState({recipients});
      renderRecipients();
    }

    function ensureRecipientsForQty(){
      const s = readState();
      const qty = Number(s.qty || 1);
      let recs = getRecipients();

      // always keep at least 1
      if(recs.length === 0){
        recs = [{toName:"", toStreet:"", toZip:"", toCity:""}];
      }
      // clamp to qty
      if(recs.length > qty) recs = recs.slice(0, qty);
      // no auto-expand to qty (user adds via button), BUT show cap info
      setRecipients(recs);
    }

    function renderRecipients(){
      const box = $("recipients");
      if(!box) return;

      const s = readState();
      const qty = Number(s.qty || 1);
      const recs = getRecipients();

      const tag = $("recCountTag");
      if(tag) tag.textContent = `${recs.length} / ${qty}`;

      const addBtn = $("addRecipient");
      if(addBtn){
        addBtn.disabled = recs.length >= qty;
        addBtn.style.opacity = addBtn.disabled ? ".55" : "1";
      }

      box.innerHTML = recs.map((r,i)=>`
        <div class="recCard" data-i="${i}">
          <div class="recHead">
            <b>Empf√§nger #${i+1}</b>
            <div style="display:flex;gap:10px;align-items:center">
              <span class="recTag">${qty>1 ? "Multi-Empf√§nger" : "Single"}</span>
              ${recs.length>1 ? `<button class="btn btnSmall btnDanger" type="button" data-del="${i}">Entfernen</button>` : ``}
            </div>
          </div>

          <div class="row">
            <div>
              <label class="lbl">Name</label>
              <input data-k="toName" value="${esc(r.toName||"")}" placeholder="z. B. Lisa" />
            </div>
            <div>
              <label class="lbl">Stra√üe & Hausnummer</label>
              <input data-k="toStreet" value="${esc(r.toStreet||"")}" placeholder="Musterstra√üe 12" />
            </div>
          </div>

          <div class="row">
            <div>
              <label class="lbl">PLZ</label>
              <input data-k="toZip" value="${esc(r.toZip||"")}" inputmode="numeric" placeholder="10115" />
            </div>
            <div>
              <label class="lbl">Ort</label>
              <input data-k="toCity" value="${esc(r.toCity||"")}" placeholder="Berlin" />
            </div>
          </div>
        </div>
      `).join("");

      // wire inputs
      qsa(".recCard", box).forEach(card=>{
        const i = Number(card.dataset.i);
        qsa("input", card).forEach(inp=>{
          inp.addEventListener("input", ()=>{
            const recs2 = getRecipients();
            const k = inp.dataset.k;
            recs2[i] = Object.assign({}, recs2[i], {[k]: inp.value});
            writeState({recipients: recs2});
            // update tag fast
            const tag = $("recCountTag");
            if(tag){
              const qty = Number(readState().qty || 1);
              tag.textContent = `${recs2.length} / ${qty}`;
            }
          });
        });
      });

      // wire delete
      qsa("button[data-del]", box).forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const i = Number(btn.dataset.del);
          const recs2 = getRecipients().filter((_,idx)=>idx!==i);
          setRecipients(recs2.length ? recs2 : [{toName:"",toStreet:"",toZip:"",toCity:""}]);
        });
      });
    }

    $("addRecipient")?.addEventListener("click", ()=>{
      const s = readState();
      const qty = Number(s.qty || 1);
      const recs = getRecipients();
      if(recs.length >= qty) return;
      recs.push({toName:"", toStreet:"", toZip:"", toCity:""});
      setRecipients(recs);
      // scroll to new card
      setTimeout(()=> document.querySelector(".recCard:last-child")?.scrollIntoView({behavior:"smooth", block:"start"}), 60);
    });

    /* Sender fields */
    ["fromName","fromStreet","fromZip","fromCity"].forEach(id=>{
      $(id)?.addEventListener("input", ()=>writeState({[id]: $(id).value}));
    });

    /* Summary */
    function renderSummary(){
      const s = readState();
      const pack = s.pack || "Custom";
      const qty = Number(s.qty||1);
      const p = pricing(pack, qty);
      const d = getDesign();
      const recs = getRecipients();

      const recLines = recs.map((r,i)=>`#${i+1} ${esc(r.toName||"‚Äî")}, ${esc(r.toStreet||"‚Äî")}, ${esc((r.toZip||"‚Äî")+" "+(r.toCity||"‚Äî"))}`).join("<br/>");

      $("summary").innerHTML = `
        <b>Paket:</b> ${esc(pack)}<br/>
        <b>Anzahl:</b> ${qty} ${p.deal ? `<span class="muted">(${esc(p.deal.label)})</span>` : ""}<br/>
        <b>Preis:</b> ${esc(money(p.total))}<br/><br/>

        <b>Message:</b><br/>${esc(s.msg||"‚Äî")}<br/><br/>

        <b>Design:</b> ${esc(designLabel(d))}<br/><br/>

        <b>Empf√§nger:</b><br/>${recLines}<br/><br/>

        <b>Antwort-Keks an:</b> ${esc(s.fromName||"‚Äî")}, ${esc(s.fromStreet||"‚Äî")}, ${esc((s.fromZip||"‚Äî")+" "+(s.fromCity||"‚Äî"))}
      `;
    }

    /* Step 5 sync */
    function syncPayPanel(){
      const s = readState();
      const pack = s.pack || "Custom";
      const qty = Number(s.qty||1);
      const p = pricing(pack, qty);
      const recs = getRecipients();

      $("payBtn").href = STRIPE_PAYMENT_LINK;

      $("oid").textContent = s.orderId || "(wird erstellt)";
      $("sPack").textContent = pack;
      $("sQty").textContent = String(qty);
      $("sTotal").textContent = money(p.total);
      $("sMsg").textContent = s.msg ? (s.msg.slice(0,120)+(s.msg.length>120?"‚Ä¶":"")) : "(deine Message)";
      $("sDesign").textContent = designLabel(getDesign());
      $("sRecs").textContent = recs.length ? `${recs.length} Empf√§nger` : "‚Äî";

      renderStampUI();
    }

    /* =========================
       Stempelkarte (10 = Reward)
    ========================= */
    function getStamps(){
      const s = readState();
      return {
        stamps: Number(s.stamps || 0),
        rewards: Number(s.rewards || 0)
      };
    }
    function setStamps(next){
      writeState(next);
      renderStampUI();
    }
    function renderStampUI(){
      const g = $("stampGrid");
      if(!g) return;

      const {stamps, rewards} = getStamps();
      const mod = stamps % 10;
      const filled = mod === 0 && stamps > 0 ? 10 : mod;

      g.innerHTML = Array.from({length:10}).map((_,i)=>{
        const on = i < filled;
        return `<div class="stamp ${on ? "on":""}" title="${on?"Stempel":"‚Äî"}">${on ? "üç™" : "¬∑"}</div>`;
      }).join("");

      const hint = $("stampHint");
      if(hint){
        const left = (10 - filled) % 10;
        hint.textContent = filled === 10 ? `Belohnung freigeschaltet. (Gesammelt: ${stamps}, Belohnungen: ${rewards})`
                                         : `Noch ${left} Stempel bis zur Belohnung. (Gesammelt: ${stamps})`;
      }

      const badge = $("rewardBadge");
      if(badge){
        badge.classList.toggle("show", filled === 10);
      }
    }
    function maybeRewardOverlay(){
      const {stamps} = getStamps();
      if(stamps <= 0) return;
      const mod = stamps % 10;
      if(mod !== 0) return;

      const ov = $("rewardOverlay");
      if(!ov) return;

      const s = readState();
      $("rewardSub") && ($("rewardSub").textContent = `Stempel: ${s.stamps} ¬∑ Belohnungen: ${s.rewards||0}`);
      ov.classList.add("show");
      ov.setAttribute("aria-hidden","false");
    }
    $("rewardClose")?.addEventListener("click", ()=>{
      $("rewardOverlay")?.classList.remove("show");
      $("rewardOverlay")?.setAttribute("aria-hidden","true");
    });
    $("rewardShare")?.addEventListener("click", async ()=>{
      const url = shareUrl();
      const text = "Ich hab ‚Äône Belohnung bei OnlyKeks freigeschaltet. üç™üéÅ";
      try{
        if(navigator.share){
          await navigator.share({title:"OnlyKeks", text, url});
        }else{
          await copyText(url);
        }
      }catch(e){}
      $("rewardOverlay")?.classList.remove("show");
      $("rewardOverlay")?.setAttribute("aria-hidden","true");
    });

    /* Cookie Rain (dezent, inkl. Maus) */
    function startCookieRain(){
      if(window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;
      let n = 0;
      const max = 18;
      const types = ["smiley","classic","mouse"];
      const tick = ()=>{
        if(!document.documentElement.classList.contains("appReady")) return;
        if(n++ > max) return;
        const el = document.createElement("div");
        el.className = "cookieDrop";
        const t = types[Math.floor(Math.random()*types.length)];
        el.textContent = (t==="mouse") ? "üê≠üç™" : (t==="smiley") ? "üç™üôÇ" : "üç™";
        el.style.left = Math.floor(Math.random()*100) + "vw";
        el.style.animationDuration = (3.2 + Math.random()*2.6).toFixed(2) + "s";
        document.body.appendChild(el);
        setTimeout(()=>el.remove(), 8000);
        setTimeout(tick, 180 + Math.random()*220);
      };
      setTimeout(tick, 450);
    }

    /* Buttons */
    $("next1")?.addEventListener("click", ()=>{
      const txt = (msg?.value || "").trim();
      if(!txt){ msg?.focus(); return; }
      go(2);
    });
    $("back2")?.addEventListener("click", ()=>go(1));
    $("next2")?.addEventListener("click", ()=>go(3));
    $("back3")?.addEventListener("click", ()=>go(2));
    $("next3")?.addEventListener("click", ()=>{
      const s = readState();

      // validate sender
      const needSender = ["fromName","fromStreet","fromZip","fromCity"];
      const missS = needSender.filter(k=>!String(s[k]||"").trim());
      if(missS.length){ $(missS[0])?.focus(); return; }

      // validate recipients count
      const qty = Number(s.qty||1);
      const recs = getRecipients();
      if(recs.length < qty){
        // allow underfill but must be at least 1
        if(recs.length < 1) return;
      }
      // validate each recipient minimal
      for(let i=0;i<recs.length;i++){
        const r = recs[i];
        const miss = ["toName","toStreet","toZip","toCity"].find(k=>!String(r[k]||"").trim());
        if(miss){
          // focus first missing field
          const card = document.querySelector(`.recCard[data-i="${i}"]`);
          card?.querySelector(`input[data-k="${miss}"]`)?.focus();
          return;
        }
      }

      renderSummary();
      go(4);
    });
    $("back4")?.addEventListener("click", ()=>go(3));
    $("next4")?.addEventListener("click", ()=>{
      const s = readState();
      if(!s.orderId) writeState({orderId: uid()});
      go(5);
    });
    $("back5")?.addEventListener("click", ()=>go(4));

    /* Pay click: add stamps (qty) + reward logic */
    $("payBtn")?.addEventListener("click", ()=>{
      const s = readState();
      const qty = Number(s.qty || 1);

      const cur = getStamps();
      const nextStamps = cur.stamps + qty;

      // count reward when crossing multiples of 10 (simple: if new stamps % 10 == 0)
      let rewards = cur.rewards;
      if(nextStamps > 0 && (nextStamps % 10 === 0)) rewards += 1;

      setStamps({stamps: nextStamps, rewards});

      // show reward overlay if exactly multiple of 10
      setTimeout(maybeRewardOverlay, 350);

      // also remember orderCount (business metric)
      writeState({orderCount: Number(s.orderCount||0) + 1});
    });

    /* Consent */
    const CONSENT_KEY = "onlykeks_consent_v2";
    const consentEl = $("consent");
    function showConsent(){ if(!localStorage.getItem(CONSENT_KEY)) consentEl?.classList.add("show"); }
    function setConsent(mode){ localStorage.setItem(CONSENT_KEY, mode); consentEl?.classList.remove("show"); }
    $("consentAll")?.addEventListener("click", ()=>setConsent("all"));
    $("consentNeed")?.addEventListener("click", ()=>setConsent("need"));
    showConsent();

    /* Boot */
    (function boot(){
      // ensure uid
      getUID();

      // restore message
      const s = readState();
      if(msg && s.msg){ msg.value = s.msg; }
      updateCount();

      // restore pack/qty
      setPack(s.pack || "Custom");
      setQty(s.qty || 1);

      // restore sender
      ["fromName","fromStreet","fromZip","fromCity"].forEach(id=>{
        const el = $(id);
        if(el && s[id]) el.value = s[id];
      });

      // recipients
      ensureRecipientsForQty();
      renderRecipients();

      // configurator
      wireConfigurator();

      // share hint
      updateShareHint();

      // cookie rain after intro done
      setTimeout(startCookieRain, 650);

      // initial stamps render
      renderStampUI();
    })();
  </script>
</body>
              </html>
