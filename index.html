from pathlib import Path

html = r"""<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OnlyKeks ‚Äì Post, die schmeckt</title>
  <meta name="description" content="Gestalte deinen Keks. Verschicken. QR‚ÄëR√ºcksendung bekommen. Wir backen den R√ºcksend‚ÄëKeks und schicken ihn dir." />
  <meta name="theme-color" content="#ff4fa3" />
  <meta name="robots" content="index,follow" />
  <style>
    :root{
      --bg:#ffffff;
      --ink:#0b1b2a;
      --muted:#516173;
      --line: rgba(11,27,42,.10);

      --pink:#ff4fa3;
      --pink2:#ff7cc5;

      --shadow: 0 16px 50px rgba(11,27,42,.10);
      --r: 18px;
      --r2: 26px;

      --max: 1040px;
      --h1: clamp(28px, 5vw, 52px);
      --h2: clamp(20px, 3.4vw, 30px);
      --fz: 16px;
      --focus: 0 0 0 4px rgba(255,79,163,.22);

      /* VIP Schwarz/Gold */
      --gold:#d6a100;
      --glow-leg: 0 0 0 3px rgba(214,161,0,.25), 0 12px 34px rgba(214,161,0,.18);
      --glow-myth:0 0 0 3px rgba(214,161,0,.30), 0 14px 42px rgba(0,0,0,.55);
    }
    *{ box-sizing:border-box; margin:0; padding:0; }
    html,body{ height:100%; }
    body{
      font: 800 var(--fz)/1.55 system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
      color: var(--ink);
      background: var(--bg);
      overflow-x: hidden;
    }
    a{ color:inherit; text-decoration:none; }
    button{ cursor:pointer; }

    .wrap{ max-width: var(--max); margin:0 auto; padding: 16px 16px 70px; position:relative; z-index:1; }

    /* Hintergrund: dezenter Keksregen */
    #keksRain{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      opacity:.28;
      background-image:
        radial-gradient(circle at 18% 10%, rgba(255,79,163,.12), transparent 55%),
        radial-gradient(circle at 82% 22%, rgba(255,124,197,.10), transparent 55%);
    }
    #keksRain::before, #keksRain::after{
      content:"üç™   üç™    üç™  üç™   üç™    üç™";
      position:absolute; left:-10%; top:-10%;
      width:120%; height:120%;
      font-size: 20px;
      opacity:.28;
      transform: rotate(-8deg);
      animation: rain 16s linear infinite;
      white-space: pre-wrap;
      line-height: 3.2;
    }
    #keksRain::after{
      font-size: 16px;
      opacity:.20;
      animation-duration: 22s;
      transform: rotate(10deg);
    }
    @keyframes rain{
      0%{ transform: translateY(-12%) rotate(-8deg); }
      100%{ transform: translateY(18%) rotate(-8deg); }
    }

    /* Header */
    header{
      position: sticky; top:0; z-index:50;
      background: rgba(255,255,255,.82);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(11,27,42,.06);
    }
    .head{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 10px 16px;
      max-width: var(--max); margin:0 auto;
    }
    .brand{ display:flex; align-items:center; gap:12px; min-width: 180px; }
    .logo{
      width: 46px; height: 46px; border-radius: 16px;
      background: radial-gradient(circle at 30% 25%, #fff 0 18%, #ffe7f3 19% 46%, #ff9ed0 47% 70%, #ff4fa3 71% 100%);
      box-shadow: 0 10px 22px rgba(11,27,42,.10);
      position:relative; overflow:hidden;
    }
    .logo:before{
      content:""; position:absolute; inset:10px; border-radius:999px;
      background: radial-gradient(circle at 35% 35%, #fff6e8 0 38%, #f6c07c 39% 100%);
      opacity:.92;
    }
    .brandTitle{ line-height:1.05; font-weight:1000; font-size:18px; }
    .brandSub{ font-size:12px; color: var(--muted); font-weight:900; }

    nav{ display:flex; align-items:center; gap:12px; }
    nav a{ font-weight:1000; padding: 10px 10px; border-radius: 12px; color: rgba(11,27,42,.86); }
    nav a:hover{ background: rgba(11,27,42,.05); }

    .btn{
      appearance:none; border:0;
      padding: 12px 14px; border-radius: 14px;
      font-weight:1000;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(11,27,42,.08);
      color: rgba(11,27,42,.88);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      user-select:none;
      touch-action:manipulation;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 14px 40px rgba(11,27,42,.10); }
    .btn:active{ transform:translateY(0); }
    .btnPrimary{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#fff;
      box-shadow: 0 12px 28px rgba(11,27,42,.12);
      border:0;
    }
    .btnGold{
      background: linear-gradient(135deg, rgba(214,161,0,1), rgba(255,220,120,1));
      color:#111;
      box-shadow: 0 18px 50px rgba(214,161,0,.22);
      border:0;
    }

    /* Intro overlay: fullscreen video, fade-out, then remove */
    #introOverlay{
      position:fixed; inset:0; z-index:9999;
      background:#000;
      display:flex; align-items:center; justify-content:center;
      opacity:1;
      transition: opacity .42s ease;
    }
    #introOverlay.hidden{
      opacity:0;
      pointer-events:none;
    }
    #introVideo{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      transform: translateZ(0);
    }
    #skipIntro{
      position:absolute; top:12px; right:12px;
      z-index:2;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.35);
      color:#fff;
      font-weight:1000;
      backdrop-filter: blur(8px);
    }

    /* Cookie consent */
    #cookieOverlay{
      position:fixed; inset:0; z-index:10000;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .cookieContent{
      max-width: 560px;
      width:100%;
      padding: 22px;
      border-radius: 24px;
      background: #fff;
      box-shadow: 0 24px 60px rgba(11,27,42,.25);
      text-align:left;
    }
    .cookieContent h3{
      margin:0 0 6px; font-size:22px; font-weight:1000;
    }
    .cookieContent p{
      margin:0; font-size:15px; color: var(--muted); font-weight:850; line-height:1.45;
    }
    .cookieActions{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:16px; justify-content:flex-start;
    }

    /* Toast */
    #keksToast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      padding:.75rem 1rem; border-radius:14px;
      background:rgba(255,255,255,.94);
      border:1px solid rgba(0,0,0,.10);
      box-shadow:0 16px 50px rgba(0,0,0,.18);
      font-weight:1000; z-index:99999;
      opacity:0; pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
      max-width:min(92vw, 520px);
      text-align:center;
    }
    #keksToast.show{ opacity:1; transform:translateX(-50%) translateY(-6px); }

    /* Hero */
    .hero{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
      align-items: stretch;
      padding: 22px 0 8px;
    }
    .card{
      background:#fff;
      border: 1px solid var(--line);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      padding: 16px;
      position:relative;
    }
    h1{ margin:0 0 10px; font-size: var(--h1); line-height:1.04; letter-spacing:-.6px; }
    .sub{ margin:0 0 12px; color: var(--muted); font-weight:850; max-width: 60ch; }
    .chips{ display:flex; flex-wrap:wrap; gap:10px; margin-top: 12px; }
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(11,27,42,.10);
      background: rgba(255,255,255,.85);
      font-weight:1000;
      color: rgba(11,27,42,.80);
    }
    .ctaRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; align-items:center; }

    /* HERO-CTA BOOST */
    .hero .btnPrimary.heroCta{
      font-size:16px;
      padding:18px 26px;
      box-shadow:
        0 18px 40px rgba(255,79,163,.35),
        0 0 0 0 rgba(255,79,163,.45);
      animation: pulseGlow 2.4s ease-in-out infinite;
    }
    @keyframes pulseGlow{
      0%   { box-shadow: 0 18px 40px rgba(255,79,163,.35), 0 0 0 0 rgba(255,79,163,.35); }
      70%  { box-shadow: 0 22px 55px rgba(255,79,163,.45), 0 0 0 12px rgba(255,79,163,0); }
      100% { box-shadow: 0 18px 40px rgba(255,79,163,.35), 0 0 0 0 rgba(255,79,163,0); }
    }
    .price-hint{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
      font-weight:900;
    }
    .price-hint b{ color:var(--ink); }

    /* Cookie float */
    .cookie-float{
      position:absolute;
      left:-40px;
      top:42%;
      font-size:64px;
      animation: cookieIn 1.6s ease-out forwards;
      filter: drop-shadow(0 12px 24px rgba(0,0,0,.18));
      pointer-events:none;
      opacity:0;
    }
    @keyframes cookieIn{
      0%{ transform: translateX(-120px) rotate(-25deg) scale(.6); opacity:0; }
      100%{ transform: translateX(0) rotate(0deg) scale(1); opacity:1; }
    }

    .trust{
      display:grid; grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 10px;
    }
    .trustItem{
      border: 1px solid rgba(11,27,42,.08);
      background: rgba(11,27,42,.03);
      border-radius: var(--r);
      padding: 12px;
      font-weight: 950;
      min-height:64px;
    }
    .trustItem small{ display:block; margin-top:4px; color: var(--muted); font-weight:850; }

    .mini-quotes{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
      font-weight:900;
    }
    .mini-quotes span{
      padding:8px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.75);
      border:1px solid var(--line);
    }

    section{ padding: 14px 0; }
    h2{ margin: 0 0 10px; font-size: var(--h2); letter-spacing:-.3px; }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .muted{ color: var(--muted); font-weight:850; }

    /* Configurator */
    .cfg{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 14px;
      align-items:start;
    }
    label{ display:block; margin-top: 12px; font-weight:1000; }
    input, textarea, select{
      width:100%;
      margin-top:8px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(11,27,42,.14);
      font: inherit;
      background:#fff;
      color: var(--ink);
      font-weight:900;
    }
    textarea{ min-height: 96px; resize: vertical; }
    input:focus, textarea:focus, select:focus{
      outline:none; box-shadow: var(--focus); border-color: rgba(255,79,163,.55);
    }

    .packRow{ display:grid; gap:10px; margin-top: 6px; }
    .packTile{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 12px;
      border-radius: var(--r);
      border: 1px solid rgba(11,27,42,.10);
      background:#fff;
      cursor:pointer;
      font-weight:1000;
      transition: box-shadow .18s ease, border-color .18s ease, transform .12s ease;
    }
    .packTile:hover{ box-shadow: 0 12px 30px rgba(255,79,163,.10); transform: translateY(-1px); }
    .packTile.active{
      border-color: rgba(255,79,163,.45);
      box-shadow: 0 12px 30px rgba(255,79,163,.12);
      background: rgba(255,79,163,.06);
    }
    .badge{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(11,27,42,.10);
      background: rgba(255,255,255,.90);
      font-weight:1000;
    }
    .badgeHot{ border-color: rgba(255,79,163,.35); background: rgba(255,79,163,.08); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .miniCard{
      border: 1px solid rgba(11,27,42,.10);
      border-radius: var(--r);
      background: #fff;
      padding: 12px;
    }

    /* Preview (3D) */
    .previewWrap{
      border: 1px solid rgba(11,27,42,.10);
      background: rgba(255,255,255,.78);
      border-radius: var(--r2);
      padding: 12px;
      overflow: visible;
    }
    .previewStage{
      border-radius: var(--r2);
      border: 1px solid rgba(11,27,42,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.64));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
      min-height: 320px;
      padding: 0;
      overflow: hidden;
      position:relative;
    }
    #threeCanvas{
      width:100%; height:100%;
      display:block;
      touch-action:none;
    }
    .hint3d{
      position:absolute; left:12px; bottom:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(11,27,42,.10);
      background: rgba(255,255,255,.80);
      backdrop-filter: blur(8px);
      font-weight:1000;
      font-size:12.5px;
      color: rgba(11,27,42,.78);
    }

    .stickyPay{
      position: sticky;
      bottom: 10px;
      z-index: 5;
      margin-top: 14px;
    }

    .items{ display:grid; gap: 12px; margin-top: 12px; }
    .itemHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }

    footer{ padding: 24px 0 40px; color: rgba(11,27,42,.70); }
    .footer-cols{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:16px;
      margin-top:14px;
    }
    .footer-cols b{
      display:block;
      margin-bottom:6px;
      color:var(--ink);
      font-weight:1100;
    }
    .footer-cols a{
      display:block;
      margin-bottom:6px;
      color: rgba(11,27,42,.78);
      font-weight:950;
    }
    .footer-cols a:hover{ text-decoration:underline; }

    /* Hall of Keks (VIP) */
    .hallVIP{
      background: linear-gradient(180deg, rgba(11,11,14,1), rgba(11,11,14,.94));
      color:#fff;
      border: 1px solid rgba(214,161,0,.35);
      box-shadow: 0 26px 90px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .hallVIP::after{
      content:""; position:absolute; inset:-40%;
      background: radial-gradient(closest-side, rgba(214,161,0,.18), transparent 60%);
      transform: rotate(18deg);
      pointer-events:none;
    }
    .hallGrid{display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap: 12px; margin-top: 12px;}
    .hallCard{
      border-radius: 20px;
      border: 1px solid rgba(214,161,0,.28);
      background: rgba(255,255,255,.06);
      padding: 12px;
      position:relative;
      overflow:hidden;
    }
    .hallCardTop{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .hallMsg{margin-top:10px; font-weight:950; opacity:.95}
    .hallMeta{margin-top:8px; font-size:12.5px; opacity:.82; font-weight:850}
    .rarityBadge{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.35rem .65rem;border-radius:999px;
      font-weight:1000;font-size:.85rem;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.10);
      color:#fff;
      box-shadow: var(--glow-leg);
    }
    .rarityBadge.myth{ box-shadow: var(--glow-myth); border-color: rgba(214,161,0,.90); }

    @media (max-width: 900px){
      nav{ display:none; }
      .hero{ grid-template-columns: 1fr; }
      .cfg{ grid-template-columns: 1fr; }
      .trust{ grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 520px){
      .trust{ grid-template-columns: 1fr; }
      #heroSub{
        display:-webkit-box;
        -webkit-line-clamp:2;
        -webkit-box-orient:vertical;
        overflow:hidden;
      }
      .previewStage{ min-height: 300px; }
    }
  </style>
</head>

<body id="top">
  <div id="keksRain" aria-hidden="true"></div>
  <div id="keksToast" aria-live="polite"></div>

  <!-- Intro overlay -->
  <div id="introOverlay" aria-label="Intro">
    <button id="skipIntro" type="button" aria-label="Intro √ºberspringen">Skip</button>
    <video id="introVideo" muted playsinline preload="auto" autoplay>
      <source src="assets/video/grok_video_2025-12-14-00-41-51.mp4" type="video/mp4">
    </video>
  </div>

  <!-- Cookie consent overlay (nach Intro) -->
  <div id="cookieOverlay" role="dialog" aria-modal="true" aria-label="Cookie Einstellungen">
    <div class="cookieContent">
      <h3>Darf ich kurz reincrunchen?</h3>
      <p>Wir brauchen ein paar <b>notwendige</b> Kr√ºmel, damit dein Keks‚ÄëEntwurf nicht verloren geht. Optional helfen Extra‚ÄëKr√ºmel, zu checken, welche Kekse am meisten gefeiert werden. Wir verkaufen keine Daten.</p>
      <div class="cookieActions">
        <button class="btn btnPrimary" id="cookieAccept">Alles klar, gib Kr√ºmel üç™</button>
        <button class="btn" id="cookieEssential">Nur das N√∂tigste</button>
        <a class="btn" href="privacy.html">Wie wir mit Daten umgehen</a>
      </div>
    </div>
  </div>

  <header>
    <div class="head">
      <a class="brand" href="#top" aria-label="OnlyKeks Start">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="brandTitle">OnlyKeks</div>
          <div class="brandSub">Post, die schmeckt</div>
        </div>
      </a>

      <nav aria-label="Navigation">
        <a href="#so-gehts">So geht‚Äôs</a>
        <a href="#konfigurator">Konfigurator</a>
        <a href="#hall">Hall of Keks</a>
        <a href="#faq">FAQ</a>
      </nav>

      <button class="btn btnPrimary" type="button" onclick="document.getElementById('konfigurator').scrollIntoView({behavior:'smooth'})">
        Jetzt starten ‚Üí
      </button>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="card">
        <div class="cookie-float" aria-hidden="true">üç™</div>
        <h1>Schick ‚Äônen Keks. Hol dir ‚Äônen R√ºcksend‚ÄëKeks.</h1>
        <p class="sub" id="heroSub">
          Du schickst eine s√º√üe Botschaft mit QR‚ÄëCode. Die Empf√§ngerin scannt, schreibt den R√ºcksend‚ÄëText ‚Äì und wir backen den R√ºcksend‚ÄëKeks und schicken ihn dir.
        </p>

        <div class="ctaRow">
          <button class="btn btnPrimary heroCta" type="button" onclick="document.getElementById('konfigurator').scrollIntoView({behavior:'smooth'})">
            Keks gestalten ‚Üí
          </button>
          <button class="btn" type="button" onclick="document.getElementById('so-gehts').scrollIntoView({behavior:'smooth'})">
            So funktioniert‚Äôs
          </button>
        </div>

        <div class="price-hint">ab <b>9,90 ‚Ç¨</b> ¬∑ inkl. Karte & QR‚ÄëR√ºcksendung</div>

        <div class="chips" aria-label="Ablauf">
          <span class="chip">Keks w√§hlen</span>
          <span class="chip">Botschaft drauf</span>
          <span class="chip">QR scannen</span>
          <span class="chip">R√ºck‚ÄëKeks kommt</span>
        </div>

        <div class="mini-quotes" aria-label="Mini Testimonials">
          <span>‚ÄûKam mega an. Hat direkt zur√ºckgeschrieben.‚Äú</span>
          <span>‚ÄûBesser als jeder Brief.‚Äú</span>
        </div>
      </div>

      <div class="card">
        <div class="trust">
          <div class="trustItem">Versand mit Tracking<small>Du siehst, wo der Keks ist.</small></div>
          <div class="trustItem">Sicher bezahlen<small>Zahlungslink (Stripe) m√∂glich.</small></div>
          <div class="trustItem">Ohne Account<small>Scannen ‚Üí tippen ‚Üí absenden.</small></div>
          <div class="trustItem">Allergene klar<small>Transparente Infos.</small></div>
        </div>
      </div>
    </section>

    <section id="so-gehts">
      <div class="grid2">
        <div class="card">
          <h2>So geht‚Äôs</h2>
          <p class="muted">
            Du gestaltest deinen Keks und verschickst ihn. Auf dem Keks ist ein QR‚ÄëCode.
            Die Empf√§ngerin scannt ihn, schreibt den R√ºcksend‚ÄëText ‚Äì wir backen daraus den R√ºcksend‚ÄëKeks und schicken ihn zur√ºck.
          </p>
        </div>
        <div class="card">
          <h2>Wichtig</h2>
          <p class="muted">
            MVP‚ÄëLogik: Entw√ºrfe werden lokal gespeichert. Sharing/Ranking l√§uft √ºber Design‚ÄëCodes (Link) ‚Äì serverseitig sp√§ter.
          </p>
        </div>
      </div>
    </section>

    <section id="konfigurator">
      <div class="card">
        <h2>Konfigurator</h2>
        <p class="muted">Fokus: <b>echter 3D‚ÄëKeks</b>. Drehen, zoomen, klicken. Deko & Text wirken direkt auf die Vorschau.</p>

        <div class="cfg" style="margin-top:12px;">
          <!-- Left -->
          <div>
            <label>Paket</label>
            <select id="pack" aria-label="Paket w√§hlen">
              <option value="Quick">Quick</option>
              <option value="Custom" selected>Custom</option>
              <option value="Premium">Premium</option>
            </select>

            <div class="packRow" id="packTiles" aria-label="Pakete">
              <div class="packTile" data-pack="Quick">
                <div>
                  <div style="font-weight:1100;">Quick</div>
                  <div class="muted" style="font-size:13px;">Schnell & sweet. F√ºr kurze Messages.</div>
                </div>
                <span class="badge">simple & sweet</span>
              </div>
              <div class="packTile active" data-pack="Custom">
                <div>
                  <div style="font-weight:1100;">Custom</div>
                  <div class="muted" style="font-size:13px;">Deko‚ÄëFeeling + nicer Look. Bestseller.</div>
                </div>
                <span class="badge badgeHot">3er‚ÄëDeal: ‚àí15%</span>
              </div>
              <div class="packTile" data-pack="Premium">
                <div>
                  <div style="font-weight:1100;">Premium</div>
                  <div class="muted" style="font-size:13px;">Box‚ÄëFeeling + maximaler Wow‚ÄëEffekt.</div>
                </div>
                <span class="badge">Box‚ÄëVibe</span>
              </div>
            </div>

            <label>Wie viele Kekse willst du verschicken?</label>
            <input id="qty" type="number" min="1" max="10" value="1" inputmode="numeric" />

            <div class="miniCard" style="margin-top:12px;">
              <div style="font-weight:1100;">Deal‚ÄëHinweis</div>
              <div class="muted" style="font-size:13px;">Ab 3 Keksen ist der 3er‚ÄëDeal aktiv.</div>
            </div>

            <label>Dein Name</label>
            <input id="senderName" placeholder="z. B. Schmidti" autocomplete="name" />

            <label>Deine Adresse (R√ºcksendung)</label>
            <input id="senderAddr" placeholder="Stra√üe & Hausnummer, PLZ Ort" autocomplete="street-address" />

            <div class="stickyPay">
              <div class="miniCard">
                <div class="row" style="justify-content:space-between;">
                  <div>
                    <div style="font-weight:1100;">Gesamt</div>
                    <div class="muted" style="font-size:13px;" id="priceNote">inkl. 3er‚ÄëDeal falls aktiv</div>
                  </div>
                  <div style="font-weight:1200; font-size:20px;" id="total">‚Äî</div>
                </div>
                <div class="row" style="margin-top:10px;">
                  <button class="btn btnPrimary" type="button" id="saveDraft">Entwurf speichern</button>
                  <button class="btn" type="button" id="toPay">Weiter zum Bezahlen</button>
                </div>
                <div class="muted" style="font-size:12.5px; margin-top:10px;">
                  Hinweis: Zahlung ist im MVP Demo. Stripe‚ÄëLink kannst du sp√§ter direkt verdrahten.
                </div>
              </div>
            </div>
          </div>

          <!-- Right: 3D Preview + quick actions -->
          <div>
            <div class="previewWrap">
              <div class="row" style="justify-content:space-between;">
                <span class="badge">3D‚ÄëLive‚ÄëVorschau</span>
                <div class="row">
                  <button class="btn btnGold" type="button" id="surprise">√úberrasch mich</button>
                  <button class="btn" type="button" id="reset3d">Reset</button>
                </div>
              </div>

              <div class="previewStage" style="margin-top:10px;">
                <canvas id="threeCanvas" aria-label="3D Keks Vorschau"></canvas>
                <div class="hint3d">Tipp: Ziehen = drehen ¬∑ Pinch/Mausrad = zoomen ¬∑ Tap/Klick = Sprinkles</div>
              </div>

              <div class="row" style="margin-top:12px;">
                <span class="badge">Keksform</span>
                <button class="btn" type="button" data-shape="circle">Kreis</button>
                <button class="btn" type="button" data-shape="heart">Herz</button>
                <button class="btn" type="button" data-shape="star">Stern</button>
              </div>

              <label>Botschaft (f√ºr 3D‚ÄëText)</label>
              <input id="previewInput" maxlength="60" placeholder="z. B. Ich bin stolz auf dich." />
              <div class="muted" style="font-size:12.5px; margin-top:10px;">
                Kurz schreiben. Knallt mehr. Und sieht auf 3D sauber aus.
              </div>
            </div>

            <div class="items" id="items"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="hall">
      <div class="card hallVIP">
        <div class="row" style="justify-content:space-between;">
          <div>
            <h2 style="margin:0;">Hall of Keks</h2>
            <div style="opacity:.85;font-weight:900;">VIP‚ÄëBereich. Schwarz/Gold. Highlight‚ÄëLook.</div>
          </div>
          <div class="row">
            <button class="btn btnGold" type="button" id="refreshHall">Aktualisieren</button>
            <button class="btn" type="button" id="clearHall">Leeren</button>
          </div>
        </div>
        <div class="hallGrid" id="hallGrid"></div>
        <div class="muted" style="margin-top:12px; color:rgba(255,255,255,.75); font-weight:850;">
          MVP: Score sp√§ter √ºber Scans/Shares/Replies. Heute: optischer VIP‚ÄëSlot.
        </div>
      </div>
    </section>

    <section id="faq">
      <h2>FAQ</h2>
      <div class="grid2">
        <details class="card">
          <summary>Muss die Empf√§ngerin etwas installieren?</summary>
          <p>Nein. QR scannen, R√ºcksend‚ÄëText tippen, absenden. Fertig.</p>
        </details>
        <details class="card">
          <summary>Wie funktioniert der R√ºcksend‚ÄëKeks genau?</summary>
          <p>Der QR f√ºhrt zu einer R√ºcksend‚ÄëSeite. Der R√ºcksend‚ÄëText wird als neue Botschaft gebacken und an dich verschickt.</p>
        </details>
        <details class="card">
          <summary>Mehrere Empf√§nger ‚Äì wie funktioniert das?</summary>
          <p>Du w√§hlst die Anzahl. Jeder Keks hat eigene Botschaft und eigene Adresse. Jeder Keks bekommt seinen eigenen QR‚ÄëR√ºcksend‚ÄëLink.</p>
        </details>
        <details class="card">
          <summary>Welche Daten speichert ihr?</summary>
          <p>Notwendig: Entwurf lokal im Browser. Optional: sp√§ter Auswertung, welche Kekse gefallen. Wir verkaufen keine Daten.</p>
        </details>
      </div>
    </section>

    <footer>
      <div class="card">
        <div style="display:flex; align-items:center; gap:10px;">
          <div class="logo" aria-hidden="true" style="width:34px;height:34px;border-radius:14px;"></div>
          <div>
            <div style="font-weight:1100;">OnlyKeks</div>
            <div class="muted" style="font-size:12.5px;">One‚ÄëPage‚ÄëLanding + 3D‚ÄëKonfigurator. Geschenk‚ÄëMood, Vertrauen, QR‚ÄëR√ºcksendung.</div>
          </div>
        </div>

        <div class="footer-cols">
          <div>
            <b>Info</b>
            <a href="#so-gehts">So geht‚Äôs</a>
            <a href="#konfigurator">Konfigurator</a>
            <a href="#">Versand</a>
            <a href="#">Allergene</a>
          </div>
          <div>
            <b>Rechtliches</b>
            <a href="#">Impressum</a>
            <a href="privacy.html">Datenschutz</a>
            <a href="#">AGB</a>
          </div>
          <div>
            <b>Social</b>
            <a href="#">Instagram</a>
            <a href="#">TikTok</a>
            <a href="#">Pinterest</a>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js";
    import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/controls/OrbitControls.js";

    /* ---------- Toast ---------- */
    function toast(msg){
      const t = document.getElementById("keksToast");
      if(!t) return;
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(t._t);
      t._t = setTimeout(()=> t.classList.remove("show"), 1900);
    }

    /* ---------- Cookie Consent (erst nach Intro) ---------- */
    (function(){
      const KEY = "onlykeks_cookie_choice_v2";
      const overlay = document.getElementById("cookieOverlay");
      const acceptBtn = document.getElementById("cookieAccept");
      const essentialBtn = document.getElementById("cookieEssential");

      function show(){ overlay.style.display="flex"; }
      function hide(){ overlay.style.display="none"; }
      function setChoice(v){ localStorage.setItem(KEY, v); hide(); toast("Alles klar. Weiter geht‚Äôs."); }

      // Exposed for intro-close
      window.checkCookieConsent = function(){
        const chosen = localStorage.getItem(KEY);
        if(!chosen){ show(); }
      };

      acceptBtn?.addEventListener("click", () => setChoice("all"));
      essentialBtn?.addEventListener("click", () => setChoice("need"));
    })();

    /* ---------- Intro Overlay (FIX: endet zuverl√§ssig, blockiert nie) ---------- */
    (function(){
      const overlay = document.getElementById("introOverlay");
      const video   = document.getElementById("introVideo");
      const skip    = document.getElementById("skipIntro");
      if(!overlay || !video) {
        // if intro missing, still show cookie if needed
        if(typeof window.checkCookieConsent === "function") window.checkCookieConsent();
        return;
      }

      let closed = false;

      function closeIntro(){
        if(closed) return;
        closed = true;

        overlay.classList.add("hidden");
        try{ video.pause(); }catch(_){}

        // remove from DOM so it can NEVER block clicks
        setTimeout(() => { overlay.remove(); }, 520);

        // then cookies
        if(typeof window.checkCookieConsent === "function") window.checkCookieConsent();
      }

      // 1) Normal end
      video.addEventListener("ended", closeIntro, { once:true });

      // 2) Skip
      skip?.addEventListener("click", closeIntro);

      // 3) Hard failsafe (NOT cleared by "playing")
      setTimeout(closeIntro, 6500);

      // 4) Force autoplay; if rejected -> close
      try{
        video.muted = true;
        video.playsInline = true;
        const p = video.play();
        if(p && typeof p.catch === "function") p.catch(closeIntro);
      }catch(_){
        closeIntro();
      }

      // 5) If media errors/stalls
      video.addEventListener("error", closeIntro, { once:true });
      video.addEventListener("stalled", closeIntro, { once:true });
      video.addEventListener("abort", closeIntro, { once:true });
    })();

    /* ---------- App State (MVP) ---------- */
    const LS = { draft:"ok_draft_v3", draftId:"ok_draft_id_v1", hall:"ok_hall_v1" };
    const PRICES = { Quick: 9.90, Custom: 14.90, Premium: 24.90 };
    const DEAL_QTY = 3, DEAL_OFF = 0.15;

    function euro(n){
      return new Intl.NumberFormat("de-DE", { style:"currency", currency:"EUR" }).format(n);
    }
    function makeToken(len=18){
      const a = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let s = "";
      for(let i=0;i<len;i++) s += a[Math.floor(Math.random()*a.length)];
      return s;
    }
    function getDraftId(){
      let id = localStorage.getItem(LS.draftId);
      if(!id){
        id = "DRAFT-" + Date.now().toString(36).toUpperCase();
        localStorage.setItem(LS.draftId, id);
      }
      return id;
    }
    function basePath(){
      const u = new URL(location.href);
      u.hash = "";
      u.search = "";
      u.pathname = u.pathname.replace(/index\.html$/, "");
      return u.toString();
    }

    let state = {
      pack: "Custom",
      qty: 1,
      senderName: "",
      senderAddr: "",
      previewText: "",
      shape: "circle",
      items: []
    };

    function ensureItems(){
      const n = Math.max(1, Math.min(10, parseInt(state.qty,10) || 1));
      state.qty = n;
      while(state.items.length < n){
        state.items.push({ name:"", addr:"", msg:"", _token: makeToken(18) });
      }
      while(state.items.length > n) state.items.pop();
      state.items.forEach(it => { if(!it._token) it._token = makeToken(18); });
    }

    function calcTotal(){
      const base = PRICES[state.pack] * state.qty;
      const disc = (state.qty >= DEAL_QTY) ? base * DEAL_OFF : 0;
      return { base, disc, total: base - disc };
    }

    function replyUrlFor(idx){
      const base = basePath();
      const oid = encodeURIComponent(getDraftId());
      const k = idx + 1;
      const t = encodeURIComponent(state.items[idx]._token);
      return `${base}keks.html?oid=${oid}&k=${k}&t=${t}`;
    }

    function saveDraft(){
      const payload = { ...state, draftId: getDraftId(), savedAt: new Date().toISOString() };
      localStorage.setItem(LS.draft, JSON.stringify(payload));
      toast("Entwurf gespeichert.");
    }
    function loadDraft(){
      const raw = localStorage.getItem(LS.draft);
      if(!raw) return;
      try{
        const d = JSON.parse(raw);
        if(!d) return;
        state.pack = d.pack || state.pack;
        state.qty = d.qty || state.qty;
        state.senderName = d.senderName || "";
        state.senderAddr = d.senderAddr || "";
        state.previewText = d.previewText || "";
        state.shape = d.shape || "circle";
        state.items = Array.isArray(d.items) ? d.items : [];
      }catch(_){}
    }

    /* ---------- UI refs ---------- */
    const packSel = document.getElementById("pack");
    const packTiles = document.getElementById("packTiles");
    const qtyInp = document.getElementById("qty");
    const senderName = document.getElementById("senderName");
    const senderAddr = document.getElementById("senderAddr");
    const itemsEl = document.getElementById("items");
    const totalEl = document.getElementById("total");
    const previewInput = document.getElementById("previewInput");
    const surpriseBtn = document.getElementById("surprise");
    const reset3dBtn = document.getElementById("reset3d");
    const saveBtn = document.getElementById("saveDraft");
    const payBtn = document.getElementById("toPay");

    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;", "\"":"&quot;","'":"&#039;"
      }[m]));
    }

    function renderTotals(){
      const c = calcTotal();
      totalEl.textContent = euro(c.total);
    }

    function renderItems(){
      ensureItems();
      itemsEl.innerHTML = "";
      state.items.forEach((it, idx) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="itemHead">
            <span class="badge">Keks ${idx+1}</span>
          </div>
          <label>Empf√§ngername</label>
          <input data-kname="${idx}" placeholder="z. B. Kayti" value="${escapeHtml(it.name)}" />
          <label>Empf√§ngeradresse</label>
          <input data-kaddr="${idx}" placeholder="Stra√üe & Hausnummer, PLZ Ort" value="${escapeHtml(it.addr)}" />
          <label>Botschaft (Keks ${idx+1})</label>
          <textarea data-kmsg="${idx}" maxlength="500" placeholder="Kurze Botschaft‚Ä¶">${escapeHtml(it.msg)}</textarea>

          <div style="display:grid; gap:10px; margin-top:12px;">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
              <b>QR‚ÄëR√ºcksendung</b>
              <button class="btn" type="button" data-copyqr="${idx}">Link kopieren</button>
            </div>
            <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
              <canvas id="qr_${idx}" width="128" height="128"
                style="border-radius:14px; border:1px solid rgba(11,27,42,.10); background:#fff;"></canvas>
              <div class="muted" style="word-break:break-all; font-weight:850;">
                <span id="qrurl_${idx}"></span>
              </div>
            </div>
          </div>
        `;
        itemsEl.appendChild(card);
      });

      state.items.forEach((_, idx) => {
        const url = replyUrlFor(idx);
        const urlEl = document.getElementById(`qrurl_${idx}`);
        if(urlEl) urlEl.textContent = url;
        const c = document.getElementById(`qr_${idx}`);
        if(c && window.QRious){
          new QRious({ element: c, value: url, size: 128, level: "H" });
        }
      });
    }

    function syncPackTiles(){
      [...packTiles.querySelectorAll(".packTile")].forEach(t => {
        t.classList.toggle("active", t.dataset.pack === state.pack);
      });
    }

    /* ---------- 3D Engine ---------- */
    const canvas = document.getElementById("threeCanvas");

    const renderer = new THREE.WebGLRenderer({
      canvas,
      antialias: true,
      alpha: true,
      powerPreference: "high-performance"
    });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setClearColor(0x000000, 0);
    renderer.shadowMap.enabled = true;

    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(35, 1, 0.1, 50);
    camera.position.set(0, 1.35, 3.1);

    const controls = new OrbitControls(camera, canvas);
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;
    controls.enablePan = false;
    controls.minDistance = 2.2;
    controls.maxDistance = 4.2;
    controls.target.set(0, 0.35, 0);

    scene.add(new THREE.HemisphereLight(0xffffff, 0x2a2a2a, 1.15));

    const key = new THREE.DirectionalLight(0xffffff, 1.15);
    key.position.set(2.8, 4.2, 2.2);
    key.castShadow = true;
    key.shadow.mapSize.set(1024, 1024);
    key.shadow.camera.near = 0.1;
    key.shadow.camera.far = 20;
    key.shadow.camera.left = -4; key.shadow.camera.right = 4;
    key.shadow.camera.top = 4;  key.shadow.camera.bottom = -4;
    scene.add(key);

    const rim = new THREE.DirectionalLight(0xffe7f3, 0.55);
    rim.position.set(-3.2, 2.6, -2.2);
    scene.add(rim);

    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(10, 10),
      new THREE.ShadowMaterial({ opacity: 0.20 })
    );
    floor.rotation.x = -Math.PI / 2;
    floor.position.y = 0;
    floor.receiveShadow = true;
    scene.add(floor);

    function makeCookieMaterial(hex){
      return new THREE.MeshStandardMaterial({
        color: hex,
        roughness: 0.86,
        metalness: 0.02
      });
    }
    let cookieMat = makeCookieMaterial(0xE1B074);

    // Text canvas -> texture
    const textCanvas = document.createElement("canvas");
    textCanvas.width = 512; textCanvas.height = 256;
    const tctx = textCanvas.getContext("2d");

    function roundRect(ctx, x, y, w, h, r){
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
    }
    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      const words = text.split(/\s+/);
      let line = "";
      let lines = [];
      for(const w of words){
        const test = line ? (line + " " + w) : w;
        if(ctx.measureText(test).width > maxWidth && line){
          lines.push(line);
          line = w;
        } else {
          line = test;
        }
      }
      if(line) lines.push(line);
      if(lines.length > 3) lines = lines.slice(0,3);
      const startY = y - ((lines.length-1) * lineHeight) / 2;
      lines.forEach((ln, i)=> ctx.fillText(ln, x, startY + i*lineHeight));
    }
    function drawTextTexture(txt){
      tctx.clearRect(0,0,textCanvas.width,textCanvas.height);
      const text = (txt || "").trim().slice(0, 60);
      if(!text) return;

      tctx.globalAlpha = 0.88;
      tctx.fillStyle = "rgba(255,255,255,0.72)";
      roundRect(tctx, 48, 54, 416, 148, 36);
      tctx.fill();

      tctx.globalAlpha = 1;
      tctx.strokeStyle = "rgba(11,27,42,0.15)";
      tctx.lineWidth = 4;
      roundRect(tctx, 48, 54, 416, 148, 36);
      tctx.stroke();

      tctx.fillStyle = "rgba(11,27,42,0.86)";
      tctx.textAlign = "center";
      tctx.textBaseline = "middle";
      tctx.font = "900 40px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      wrapText(tctx, text, 256, 128, 360, 44);
    }

    const textTex = new THREE.CanvasTexture(textCanvas);
    textTex.colorSpace = THREE.SRGBColorSpace;
    textTex.anisotropy = 8;
    const textMat = new THREE.MeshBasicMaterial({ map: textTex, transparent: true });

    let cookieGroup = new THREE.Group();
    scene.add(cookieGroup);

    function clearGroup(g){
      while(g.children.length){
        const c = g.children.pop();
        c.geometry?.dispose?.();
        if(c.material){
          if(Array.isArray(c.material)) c.material.forEach(m=>m.dispose?.());
          else c.material.dispose?.();
        }
      }
    }

    // Sprinkles
    const sprinkleGeo = new THREE.CapsuleGeometry(0.025, 0.10, 3, 10);
    function sprinkleMat(){
      const colors = [0xff4fa3, 0x2a7bff, 0x37c871, 0x8a3ffc, 0xffd54a];
      return new THREE.MeshStandardMaterial({ color: colors[Math.floor(Math.random()*colors.length)], roughness: 0.65, metalness: 0.05 });
    }

    function makeCookieMesh(shape){
      clearGroup(cookieGroup);

      const height = 0.50;

      let geom;
      if(shape === "circle"){
        geom = new THREE.CylinderGeometry(1.02, 1.05, height, 80, 1, false);
      } else {
        const s = new THREE.Shape();
        if(shape === "heart"){
          s.moveTo(0, 0.35);
          s.bezierCurveTo(0, 0.9, -0.9, 0.9, -0.9, 0.25);
          s.bezierCurveTo(-0.9, -0.35, 0, -0.55, 0, -1.05);
          s.bezierCurveTo(0, -0.55, 0.9, -0.35, 0.9, 0.25);
          s.bezierCurveTo(0.9, 0.9, 0, 0.9, 0, 0.35);
        } else { // star
          const spikes = 5, outer = 1.05, inner = 0.46;
          let rot = Math.PI / 2 * 3;
          const step = Math.PI / spikes;
          s.moveTo(0, -outer);
          for(let i=0;i<spikes;i++){
            s.lineTo(Math.cos(rot)*outer, Math.sin(rot)*outer); rot += step;
            s.lineTo(Math.cos(rot)*inner, Math.sin(rot)*inner); rot += step;
          }
          s.closePath();
        }
        geom = new THREE.ExtrudeGeometry(s, { depth: height, bevelEnabled: true, bevelSegments: 4, steps: 1, bevelSize: 0.06, bevelThickness: 0.06 });
        geom.center();
        geom.rotateX(Math.PI/2);
      }
      geom.computeVertexNormals();

      const cookie = new THREE.Mesh(geom, cookieMat);
      cookie.castShadow = true;
      cookie.receiveShadow = true;
      cookie.position.y = height/2;
      cookieGroup.add(cookie);

      // Chips
      const chipGeo = new THREE.SphereGeometry(0.06, 10, 10);
      const chipMat = new THREE.MeshStandardMaterial({ color: 0x7a4c23, roughness: 0.9, metalness: 0.02 });
      const chipCount = 22;
      const chips = new THREE.InstancedMesh(chipGeo, chipMat, chipCount);
      chips.castShadow = true;
      chips.receiveShadow = true;
      const dummy = new THREE.Object3D();
      for(let i=0;i<chipCount;i++){
        const a = Math.random() * Math.PI * 2;
        const r = 0.25 + Math.random() * 0.70;
        dummy.position.set(Math.cos(a)*r, height + 0.02, Math.sin(a)*r);
        dummy.rotation.set(Math.random(), Math.random(), Math.random());
        dummy.scale.setScalar(0.55 + Math.random()*0.9);
        dummy.updateMatrix();
        chips.setMatrixAt(i, dummy.matrix);
      }
      cookieGroup.add(chips);

      // Text plane
      const plane = new THREE.Mesh(new THREE.PlaneGeometry(1.45, 0.72), textMat);
      plane.rotation.x = -Math.PI/2;
      plane.position.set(0, height + 0.03, 0);
      plane.renderOrder = 3;
      cookieGroup.add(plane);

      // Sprinkles group
      const sprGroup = new THREE.Group();
      sprGroup.name = "sprinkles";
      cookieGroup.add(sprGroup);

      function addSprinkleAt(x, z){
        const spr = new THREE.Mesh(sprinkleGeo, sprinkleMat());
        spr.castShadow = true;
        spr.receiveShadow = true;
        spr.position.set(x, height + 0.04, z);
        spr.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI);
        sprGroup.add(spr);
      }
      function addRandomSprinkles(n=6){
        for(let i=0;i<n;i++){
          const a = Math.random() * Math.PI * 2;
          const r = 0.20 + Math.random() * 0.78;
          addSprinkleAt(Math.cos(a)*r, Math.sin(a)*r);
        }
      }
      function resetSprinkles(){
        while(sprGroup.children.length){
          const c = sprGroup.children.pop();
          c.geometry.dispose();
          c.material.dispose();
        }
      }

      addRandomSprinkles(8);

      return { cookie, plane, sprGroup, addSprinkleAt, addRandomSprinkles, resetSprinkles, height };
    }

    let cookieParts = makeCookieMesh(state.shape);

    // Raycaster: click/tap to add sprinkles
    const raycaster = new THREE.Raycaster();
    const ndc = new THREE.Vector2();

    function onPointerDown(ev){
      const rect = canvas.getBoundingClientRect();
      const x = ( (ev.clientX - rect.left) / rect.width ) * 2 - 1;
      const y = - ( (ev.clientY - rect.top) / rect.height ) * 2 + 1;
      ndc.set(x,y);
      raycaster.setFromCamera(ndc, camera);
      const hits = raycaster.intersectObject(cookieParts.cookie, true);
      if(!hits.length) return;
      const p = hits[0].point;
      const lx = THREE.MathUtils.clamp(p.x, -0.95, 0.95);
      const lz = THREE.MathUtils.clamp(p.z, -0.95, 0.95);
      cookieParts.addSprinkleAt(lx, lz);
      toast("Sprinkle gesetzt.");
    }
    canvas.addEventListener("pointerdown", onPointerDown, { passive:true });

    // Idle animation
    let spinBoost = 0;
    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      const t = performance.now() * 0.0007;
      cookieGroup.rotation.y = (Math.sin(t) * 0.12) + spinBoost;
      cookieGroup.rotation.x = Math.sin(t*0.9) * 0.04;
      spinBoost *= 0.96;
      renderer.render(scene, camera);
    }
    animate();

    function resize3D(){
      const rect = canvas.getBoundingClientRect();
      const w = Math.max(1, Math.floor(rect.width));
      const h = Math.max(1, Math.floor(rect.height));
      renderer.setSize(w, h, false);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    }
    window.addEventListener("resize", resize3D);

    // Appearance updates
    function setCookieColor(hex){
      cookieMat.color.setHex(hex);
      cookieMat.needsUpdate = true;
    }
    function setShape(shape){
      state.shape = shape;
      cookieParts = makeCookieMesh(shape);
      drawTextTexture(state.previewText);
      textTex.needsUpdate = true;
      toast("Form ge√§ndert.");
    }
    function setText(txt){
      state.previewText = (txt || "").slice(0,60);
      drawTextTexture(state.previewText);
      textTex.needsUpdate = true;
    }
    function reset3D(){
      setCookieColor(0xE1B074);
      cookieParts.resetSprinkles();
      cookieParts.addRandomSprinkles(8);
      controls.reset();
      controls.target.set(0, 0.35, 0);
      camera.position.set(0, 1.35, 3.1);
      spinBoost = 0;
      toast("3D zur√ºckgesetzt.");
    }

    /* ---------- Hall of Keks ---------- */
    function loadHall(){
      const raw = localStorage.getItem(LS.hall);
      if(!raw) return [];
      try{ const arr = JSON.parse(raw); return Array.isArray(arr) ? arr : []; }catch(_){ return []; }
    }
    function saveHall(arr){ localStorage.setItem(LS.hall, JSON.stringify(arr.slice(0, 50))); }

    function renderHall(){
      const grid = document.getElementById("hallGrid");
      if(!grid) return;
      const hall = loadHall();
      grid.innerHTML = "";
      if(!hall.length){
        const d = document.createElement("div");
        d.className = "hallCard";
        d.style.gridColumn = "1 / -1";
        d.innerHTML = `<div style="font-weight:1100;">Noch leer.</div><div class="hallMeta">Speicher einen Entwurf, dann kommt der erste VIP‚ÄëSlot.</div>`;
        grid.appendChild(d);
        return;
      }
      hall.slice(0, 9).forEach(v => {
        const card = document.createElement("div");
        card.className = "hallCard";
        card.innerHTML = `
          <div class="hallCardTop">
            <span class="rarityBadge ${v.vip ? "myth" : ""}"><span>‚óè</span><span>${v.vip ? "Mythisch" : "Legend√§r"}</span></span>
            <button class="btn btnGold" type="button" data-share="${v.id}">Share</button>
          </div>
          <div class="hallMsg">‚Äû${escapeHtml(v.text || "‚Äî")}‚Äú</div>
          <div class="hallMeta">Pack: ${escapeHtml(v.pack)} ¬∑ Form: ${escapeHtml(v.shape)} ¬∑ Sprinkles: ${v.sprinkles}</div>
          <div class="hallMeta" style="opacity:.7;">${new Date(v.ts).toLocaleString("de-DE")}</div>
        `;
        card._link = v.link;
        grid.appendChild(card);
      });

      grid.querySelectorAll("button[data-share]").forEach(btn => {
        btn.addEventListener("click", async (e) => {
          const card = e.target.closest(".hallCard");
          if(!card || !card._link) return;
          try{
            if(navigator.share){
              await navigator.share({ title:"OnlyKeks ‚Äì Design", text:"Schau dir meinen Keks an", url: card._link });
              toast("Geteilt.");
              return;
            }
          }catch(_){}
          try{
            await navigator.clipboard.writeText(card._link);
            toast("Link kopiert.");
          }catch(_){
            toast("Kopieren ging nicht.");
          }
        });
      });
    }

    /* ---------- Events ---------- */
    packSel.addEventListener("change", () => {
      state.pack = packSel.value;
      renderTotals();
      syncPackTiles();
    });
    packTiles.addEventListener("click", (e) => {
      const t = e.target.closest(".packTile");
      if(!t) return;
      state.pack = t.dataset.pack;
      packSel.value = state.pack;
      renderTotals();
      syncPackTiles();
    });
    qtyInp.addEventListener("input", () => {
      state.qty = parseInt(qtyInp.value,10) || 1;
      renderTotals();
      renderItems();
    });
    senderName.addEventListener("input", () => state.senderName = senderName.value);
    senderAddr.addEventListener("input", () => state.senderAddr = senderAddr.value);

    previewInput.addEventListener("input", () => {
      setText(previewInput.value);
    });

    document.querySelectorAll("[data-shape]").forEach(b => {
      b.addEventListener("click", () => setShape(b.dataset.shape));
    });

    surpriseBtn.addEventListener("click", () => {
      const colors = [0xE1B074, 0xD7A56E, 0xC98E5A, 0xE7BE86];
      setCookieColor(colors[Math.floor(Math.random()*colors.length)]);
      cookieParts.addRandomSprinkles(6 + Math.floor(Math.random()*10));
      spinBoost += Math.PI * (0.15 + Math.random()*0.25);
      const samples = ["Ick feier dir.", "Du packst dit.", "Ich hab dich lieb.", "Danke f√ºr alles.", "Du bist Gold wert."];
      setText(samples[Math.floor(Math.random()*samples.length)]);
      previewInput.value = state.previewText;
      toast("√úberraschung aktiv.");
    });

    reset3dBtn.addEventListener("click", reset3D);

    itemsEl.addEventListener("input", (e) => {
      const el = e.target;
      if(el.dataset.kname != null){
        const i = parseInt(el.dataset.kname,10);
        state.items[i].name = el.value;
      }
      if(el.dataset.kaddr != null){
        const i = parseInt(el.dataset.kaddr,10);
        state.items[i].addr = el.value;
      }
      if(el.dataset.kmsg != null){
        const i = parseInt(el.dataset.kmsg,10);
        state.items[i].msg = el.value;
      }
    });

    itemsEl.addEventListener("click", async (e) => {
      const copy = e.target.closest("button[data-copyqr]");
      if(copy){
        const idx = parseInt(copy.dataset.copyqr,10);
        const url = replyUrlFor(idx);
        try{
          await navigator.clipboard.writeText(url);
          toast("QR‚ÄëLink kopiert.");
        }catch(_){
          toast("Kopieren ging nicht ‚Äì bitte markieren.");
        }
      }
    });

    saveBtn.addEventListener("click", () => {
      saveDraft();
      const hall = loadHall();
      const snap = {
        id: makeToken(10),
        ts: Date.now(),
        pack: state.pack,
        shape: state.shape,
        text: (state.previewText||"").slice(0,60),
        sprinkles: cookieParts.sprGroup.children.length,
        vip: (state.pack === "Premium"),
        link: location.href.split("#")[0] + "#konfigurator"
      };
      hall.unshift(snap);
      saveHall(hall);
      renderHall();
    });

    payBtn.addEventListener("click", () => {
      saveDraft();
      toast("MVP: Zahlung ist Demo. Stripe kommt als n√§chstes.");
    });

    document.getElementById("refreshHall").addEventListener("click", renderHall);
    document.getElementById("clearHall").addEventListener("click", () => {
      localStorage.removeItem(LS.hall);
      renderHall();
      toast("Hall geleert.");
    });

    /* ---------- Init ---------- */
    loadDraft();
    ensureItems();
    renderTotals();
    renderItems();
    syncPackTiles();

    previewInput.value = state.previewText || "";
    setText(previewInput.value);

    renderHall();
    setTimeout(resize3D, 50);

    // Back-compat hash
    if(location.hash === "#config") {
      document.getElementById("konfigurator").scrollIntoView({behavior:"smooth"});
    }
  </script>
</body>
</html>
"""

out = Path("/mnt/data/index_onlykeks_master_fixed.html")
out.write_text(html, encoding="utf-8")
str(out)
